{"ast":null,"code":"import _slicedToArray from \"/home/raj/.nvm/versions/node/v12.18.2/lib/node_modules/react-scripts/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _this = this,\n    _jsxFileName = \"/home/raj/go/src/github.com/litmuschaos/litmus/litmus-portal/frontend/src/views/Settings/TeammingTab/Invitation/ReceivedInvitations/index.tsx\",\n    _s = $RefreshSig$();\n\nimport { useMutation, useQuery } from '@apollo/client/react/hooks';\nimport { Avatar, Table, TableCell, TableContainer, TableRow, Typography } from '@material-ui/core';\nimport React, { useEffect, useState } from 'react';\nimport { useSelector } from 'react-redux';\nimport { useTranslation } from 'react-i18next';\nimport ButtonFilled from '../../../../../components/Button/ButtonFilled';\nimport ButtonOutline from '../../../../../components/Button/ButtonOutline';\nimport { ACCEPT_INVITE, DECLINE_INVITE, GET_USER } from '../../../../../graphql';\nimport userAvatar from '../../../../../utils/user';\nimport useStyles from './styles';\n\nvar ReceivedInvitations = function ReceivedInvitations() {\n  _s();\n\n  var classes = useStyles();\n\n  var _useTranslation = useTranslation(),\n      t = _useTranslation.t; // for response data\n\n\n  var _useState = useState([]),\n      _useState2 = _slicedToArray(_useState, 2),\n      rows = _useState2[0],\n      setRows = _useState2[1];\n\n  var username = useSelector(function (state) {\n    return state.userData.username;\n  }); // stores the user whose invitation is accepted/declined\n\n  var _useState3 = useState(''),\n      _useState4 = _slicedToArray(_useState3, 2),\n      acceptDecline = _useState4[0],\n      setAcceptDecline = _useState4[1]; // mutation to accept the invitation\n\n\n  var _useMutation = useMutation(ACCEPT_INVITE, {\n    onCompleted: function onCompleted() {\n      setRows(rows.filter(function (row) {\n        return row.username !== acceptDecline;\n      }));\n    },\n    onError: function onError() {},\n    refetchQueries: [{\n      query: GET_USER,\n      variables: {\n        username\n      }\n    }]\n  }),\n      _useMutation2 = _slicedToArray(_useMutation, 1),\n      acceptInvite = _useMutation2[0]; // mutation to decline the invitation\n\n\n  var _useMutation3 = useMutation(DECLINE_INVITE, {\n    onCompleted: function onCompleted() {\n      setRows(rows.filter(function (row) {\n        return row.username !== acceptDecline;\n      }));\n    },\n    onError: function onError() {},\n    refetchQueries: [{\n      query: GET_USER,\n      variables: {\n        username\n      }\n    }]\n  }),\n      _useMutation4 = _slicedToArray(_useMutation3, 1),\n      declineInvite = _useMutation4[0]; // query for getting all the data for the logged in user\n\n\n  var _useQuery = useQuery(GET_USER, {\n    variables: {\n      username\n    },\n    fetchPolicy: 'cache-and-network'\n  }),\n      data = _useQuery.data;\n\n  useEffect(function () {\n    if ((data === null || data === void 0 ? void 0 : data.getUser.username) === username) {\n      var projectList = data === null || data === void 0 ? void 0 : data.getUser.projects;\n      var users = [];\n      var flag = 0;\n      var roleVar = '';\n      projectList.forEach(function (project) {\n        project.members.forEach(function (member) {\n          if (member.user_name === username && member.role !== 'Owner' && member.invitation === 'Pending') {\n            flag = 1;\n            roleVar = member.role;\n          }\n        });\n\n        if (flag === 1) {\n          project.members.forEach(function (member) {\n            if (member.user_name !== username && member.role === 'Owner') {\n              users.push({\n                projectID: project.id,\n                projectName: project.name,\n                role: roleVar,\n                username: member.user_name\n              });\n            }\n          });\n          flag = 0;\n        }\n      });\n      setRows(users);\n    }\n  }, [data]);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    \"data-cy\": \"receivedInvitationModal\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(TableContainer, {\n    className: classes.table,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Table, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 9\n    }\n  }, rows.length > 0 ? rows.map(function (row) {\n    return /*#__PURE__*/React.createElement(TableRow, {\n      key: row.username,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 119,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(TableCell, {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 120,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: classes.rowDiv,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 121,\n        columnNumber: 19\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: classes.firstCol,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 122,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(Avatar, {\n      \"data-cy\": \"avatar\",\n      alt: \"User\",\n      className: classes.avatarBackground,\n      style: {\n        alignContent: 'right'\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 123,\n        columnNumber: 23\n      }\n    }, row.username ? userAvatar(row.username) : userAvatar(row.username)), /*#__PURE__*/React.createElement(\"div\", {\n      className: classes.detail,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 133,\n        columnNumber: 23\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: classes.nameRole,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 134,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 135,\n        columnNumber: 27\n      }\n    }, row.username), /*#__PURE__*/React.createElement(\"div\", {\n      className: classes.role,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 136,\n        columnNumber: 27\n      }\n    }, \"(\", row.role, \")\")), /*#__PURE__*/React.createElement(\"div\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 138,\n        columnNumber: 25\n      }\n    }, row.projectName))), /*#__PURE__*/React.createElement(\"div\", {\n      className: classes.buttonDiv,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 141,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(ButtonOutline, {\n      handleClick: function handleClick() {\n        setAcceptDecline(row.username);\n        declineInvite({\n          variables: {\n            member: {\n              project_id: row.projectID,\n              user_name: username\n            }\n          }\n        });\n      },\n      isDisabled: false,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 142,\n        columnNumber: 23\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 156,\n        columnNumber: 25\n      }\n    }, t('settings.teamingTab.invitation.receivedInvitation.button.ignore'))), /*#__PURE__*/React.createElement(\"div\", {\n      \"data-cy\": \"receivedInvitationAccept\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 162,\n        columnNumber: 23\n      }\n    }, /*#__PURE__*/React.createElement(ButtonFilled, {\n      isPrimary: false,\n      handleClick: function handleClick() {\n        setAcceptDecline(row.username);\n        acceptInvite({\n          variables: {\n            member: {\n              project_id: row.projectID,\n              user_name: username\n            }\n          }\n        });\n      },\n      isDisabled: false,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 163,\n        columnNumber: 25\n      }\n    }, t('settings.teamingTab.invitation.receivedInvitation.button.accept')))))));\n  }) : /*#__PURE__*/React.createElement(TableRow, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 189,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(TableCell, {\n    colSpan: 2,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 190,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(Typography, {\n    align: \"center\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 191,\n      columnNumber: 17\n    }\n  }, t('settings.teamingTab.invitation.receivedInvitation.noInvites')))))));\n};\n\n_s(ReceivedInvitations, \"Ai6KMJBsG/kscGREPJvpQKwXpc0=\", false, function () {\n  return [useStyles, useTranslation, useSelector, useMutation, useMutation, useQuery];\n});\n\n_c = ReceivedInvitations;\nexport default ReceivedInvitations;\n\nvar _c;\n\n$RefreshReg$(_c, \"ReceivedInvitations\");","map":{"version":3,"sources":["/home/raj/go/src/github.com/litmuschaos/litmus/litmus-portal/frontend/src/views/Settings/TeammingTab/Invitation/ReceivedInvitations/index.tsx"],"names":["useMutation","useQuery","Avatar","Table","TableCell","TableContainer","TableRow","Typography","React","useEffect","useState","useSelector","useTranslation","ButtonFilled","ButtonOutline","ACCEPT_INVITE","DECLINE_INVITE","GET_USER","userAvatar","useStyles","ReceivedInvitations","classes","t","rows","setRows","username","state","userData","acceptDecline","setAcceptDecline","onCompleted","filter","row","onError","refetchQueries","query","variables","acceptInvite","declineInvite","fetchPolicy","data","getUser","projectList","projects","users","flag","roleVar","forEach","project","members","member","user_name","role","invitation","push","projectID","id","projectName","name","table","length","map","rowDiv","firstCol","avatarBackground","alignContent","detail","nameRole","buttonDiv","project_id"],"mappings":"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","sourcesContent":["import { useMutation, useQuery } from '@apollo/client/react/hooks';\nimport {\n  Avatar,\n  Table,\n  TableCell,\n  TableContainer,\n  TableRow,\n  Typography,\n} from '@material-ui/core';\nimport React, { useEffect, useState } from 'react';\nimport { useSelector } from 'react-redux';\nimport { useTranslation } from 'react-i18next';\nimport ButtonFilled from '../../../../../components/Button/ButtonFilled';\nimport ButtonOutline from '../../../../../components/Button/ButtonOutline';\nimport {\n  ACCEPT_INVITE,\n  DECLINE_INVITE,\n  GET_USER,\n} from '../../../../../graphql';\nimport { MemberInvitation } from '../../../../../models/graphql/invite';\nimport {\n  CurrentUserDedtailsVars,\n  CurrentUserDetails,\n} from '../../../../../models/graphql/user';\nimport { RootState } from '../../../../../redux/reducers';\nimport userAvatar from '../../../../../utils/user';\nimport useStyles from './styles';\n\ninterface ReceivedInvitation {\n  projectName: string;\n  username: string;\n  role: string;\n  projectID: string;\n}\n\nconst ReceivedInvitations: React.FC = () => {\n  const classes = useStyles();\n  const { t } = useTranslation();\n\n  // for response data\n  const [rows, setRows] = useState<ReceivedInvitation[]>([]);\n\n  const username = useSelector((state: RootState) => state.userData.username);\n\n  // stores the user whose invitation is accepted/declined\n  const [acceptDecline, setAcceptDecline] = useState<string>('');\n\n  // mutation to accept the invitation\n  const [acceptInvite] = useMutation<MemberInvitation>(ACCEPT_INVITE, {\n    onCompleted: () => {\n      setRows(rows.filter((row) => row.username !== acceptDecline));\n    },\n    onError: () => {},\n    refetchQueries: [{ query: GET_USER, variables: { username } }],\n  });\n\n  // mutation to decline the invitation\n  const [declineInvite] = useMutation<MemberInvitation>(DECLINE_INVITE, {\n    onCompleted: () => {\n      setRows(rows.filter((row) => row.username !== acceptDecline));\n    },\n    onError: () => {},\n    refetchQueries: [{ query: GET_USER, variables: { username } }],\n  });\n\n  // query for getting all the data for the logged in user\n  const { data } = useQuery<CurrentUserDetails, CurrentUserDedtailsVars>(\n    GET_USER,\n    {\n      variables: { username },\n      fetchPolicy: 'cache-and-network',\n    }\n  );\n\n  useEffect(() => {\n    if (data?.getUser.username === username) {\n      const projectList = data?.getUser.projects;\n      const users: ReceivedInvitation[] = [];\n\n      let flag = 0;\n      let roleVar = '';\n\n      projectList.forEach((project) => {\n        project.members.forEach((member) => {\n          if (\n            member.user_name === username &&\n            member.role !== 'Owner' &&\n            member.invitation === 'Pending'\n          ) {\n            flag = 1;\n            roleVar = member.role;\n          }\n        });\n        if (flag === 1) {\n          project.members.forEach((member) => {\n            if (member.user_name !== username && member.role === 'Owner') {\n              users.push({\n                projectID: project.id,\n                projectName: project.name,\n                role: roleVar,\n                username: member.user_name,\n              });\n            }\n          });\n          flag = 0;\n        }\n      });\n\n      setRows(users);\n    }\n  }, [data]);\n\n  return (\n    <div data-cy=\"receivedInvitationModal\">\n      <TableContainer className={classes.table}>\n        <Table>\n          {rows.length > 0 ? (\n            rows.map((row) => (\n              <TableRow key={row.username}>\n                <TableCell>\n                  <div className={classes.rowDiv}>\n                    <div className={classes.firstCol}>\n                      <Avatar\n                        data-cy=\"avatar\"\n                        alt=\"User\"\n                        className={classes.avatarBackground}\n                        style={{ alignContent: 'right' }}\n                      >\n                        {row.username\n                          ? userAvatar(row.username)\n                          : userAvatar(row.username)}\n                      </Avatar>\n                      <div className={classes.detail}>\n                        <div className={classes.nameRole}>\n                          <div>{row.username}</div>\n                          <div className={classes.role}>({row.role})</div>\n                        </div>\n                        <div>{row.projectName}</div>\n                      </div>\n                    </div>\n                    <div className={classes.buttonDiv}>\n                      <ButtonOutline\n                        handleClick={() => {\n                          setAcceptDecline(row.username);\n                          declineInvite({\n                            variables: {\n                              member: {\n                                project_id: row.projectID,\n                                user_name: username,\n                              },\n                            },\n                          });\n                        }}\n                        isDisabled={false}\n                      >\n                        <div>\n                          {t(\n                            'settings.teamingTab.invitation.receivedInvitation.button.ignore'\n                          )}\n                        </div>\n                      </ButtonOutline>\n                      <div data-cy=\"receivedInvitationAccept\">\n                        <ButtonFilled\n                          isPrimary={false}\n                          handleClick={() => {\n                            setAcceptDecline(row.username);\n                            acceptInvite({\n                              variables: {\n                                member: {\n                                  project_id: row.projectID,\n                                  user_name: username,\n                                },\n                              },\n                            });\n                          }}\n                          isDisabled={false}\n                        >\n                          {t(\n                            'settings.teamingTab.invitation.receivedInvitation.button.accept'\n                          )}\n                        </ButtonFilled>\n                      </div>\n                    </div>\n                  </div>\n                </TableCell>\n              </TableRow>\n            ))\n          ) : (\n            <TableRow>\n              <TableCell colSpan={2}>\n                <Typography align=\"center\">\n                  {t(\n                    'settings.teamingTab.invitation.receivedInvitation.noInvites'\n                  )}\n                </Typography>\n              </TableCell>\n            </TableRow>\n          )}\n        </Table>\n      </TableContainer>\n    </div>\n  );\n};\n\nexport default ReceivedInvitations;\n"]},"metadata":{},"sourceType":"module"}