{"ast":null,"code":"import _slicedToArray from \"/home/raj/go/src/github.com/litmuschaos/litmus/litmus-portal/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _this = this,\n    _jsxFileName = \"/home/raj/go/src/github.com/litmuschaos/litmus/litmus-portal/frontend/src/views/Settings/AccountsTab/PersonalDetails/index.tsx\";\n\nimport { useMutation, useQuery } from '@apollo/client';\nimport { Typography } from '@material-ui/core';\nimport React, { useState } from 'react';\nimport { useSelector } from 'react-redux';\nimport { useTranslation } from 'react-i18next';\nimport ButtonFilled from '../../../../components/Button/ButtonFilled';\nimport Loader from '../../../../components/Loader';\nimport config from '../../../../config';\nimport Unimodal from '../../../../containers/layouts/Unimodal';\nimport { GET_USER, UPDATE_DETAILS } from '../../../../graphql';\nimport getToken from '../../../../utils/getToken';\nimport UserDetails from '../../UserManagementTab/CreateUser/UserDetails';\nimport useStyles from './styles';\n\n// Displays the personals details on the \"accounts\" tab\nvar PersonalDetails = function PersonalDetails() {\n  var _dataA$getUser$name, _dataA$getUser$email;\n\n  var classes = useStyles();\n\n  var _useTranslation = useTranslation(),\n      t = _useTranslation.t;\n\n  var username = useSelector(function (state) {\n    return state.userData.username;\n  });\n\n  var _React$useState = React.useState(false),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      loading = _React$useState2[0],\n      setLoading = _React$useState2[1]; // Query to get user details\n\n\n  var _useQuery = useQuery(GET_USER, {\n    variables: {\n      username\n    }\n  }),\n      dataA = _useQuery.data;\n\n  var _useState = useState(''),\n      _useState2 = _slicedToArray(_useState, 2),\n      error = _useState2[0],\n      setError = _useState2[1];\n\n  var name = (_dataA$getUser$name = dataA === null || dataA === void 0 ? void 0 : dataA.getUser.name) !== null && _dataA$getUser$name !== void 0 ? _dataA$getUser$name : '';\n  var email = (_dataA$getUser$email = dataA === null || dataA === void 0 ? void 0 : dataA.getUser.email) !== null && _dataA$getUser$email !== void 0 ? _dataA$getUser$email : '';\n\n  var _React$useState3 = React.useState({\n    email,\n    userName: username,\n    fullName: name\n  }),\n      _React$useState4 = _slicedToArray(_React$useState3, 2),\n      personaData = _React$useState4[0],\n      setPersonaData = _React$useState4[1]; // For closing and opening of the modal\n\n\n  var _React$useState5 = React.useState(false),\n      _React$useState6 = _slicedToArray(_React$useState5, 2),\n      open = _React$useState6[0],\n      setOpen = _React$useState6[1];\n\n  var handleClose = function handleClose() {\n    setOpen(false);\n  };\n\n  var handleUserChange = function handleUserChange(e) {\n    setPersonaData({\n      fullName: personaData.fullName,\n      userName: e.target.value,\n      email: personaData.email\n    });\n  };\n\n  var handleNameChange = function handleNameChange(e) {\n    setPersonaData({\n      fullName: e.target.value,\n      userName: personaData.userName,\n      email: personaData.email\n    });\n  };\n\n  var handleEmailChange = function handleEmailChange(e) {\n    setPersonaData({\n      fullName: personaData.fullName,\n      userName: personaData.userName,\n      email: e.target.value\n    });\n  };\n\n  var _useMutation = useMutation(UPDATE_DETAILS, {\n    onCompleted: function onCompleted() {\n      setLoading(false);\n      setOpen(true);\n    },\n    onError: function onError(error) {\n      setLoading(false);\n      setError(error.message);\n      setOpen(true);\n    },\n    refetchQueries: [{\n      query: GET_USER,\n      variables: {\n        username\n      }\n    }]\n  }),\n      _useMutation2 = _slicedToArray(_useMutation, 1),\n      updateDetails = _useMutation2[0]; // Submit entered data to /update endpoint\n\n\n  var handleSubmit = function handleSubmit() {\n    setLoading(true);\n    fetch(\"\".concat(config.auth.url, \"/update/details\"), {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        Authorization: \"Bearer \".concat(getToken())\n      },\n      body: JSON.stringify({\n        username,\n        name: personaData.fullName,\n        email: personaData.email\n      })\n    }).then(function (response) {\n      return response.json();\n    }).then(function (data) {\n      if ('error' in data) {\n        setError(data.error_description);\n        setLoading(false);\n        setOpen(true);\n      } else {\n        updateDetails({\n          variables: {\n            user: {\n              id: dataA === null || dataA === void 0 ? void 0 : dataA.getUser.id,\n              name: personaData.fullName,\n              email: personaData.email\n            }\n          }\n        });\n      }\n    }).catch(function (err) {\n      setError(err.message);\n      setOpen(true);\n      setLoading(false);\n      console.error(err);\n    });\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"form\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 127,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(UserDetails, {\n    emailIsDisabled: false,\n    nameIsDisabled: false,\n    nameValue: personaData.fullName,\n    usernameIsDisabled: true,\n    handleNameChange: handleNameChange,\n    emailValue: personaData.email,\n    handleEmailChange: handleEmailChange,\n    userValue: personaData.userName,\n    handleUserChange: handleUserChange,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 128,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: classes.saveButton,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    \"data-cy\": \"save\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 140,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(ButtonFilled, {\n    isDisabled: !(personaData.fullName.length && !loading),\n    isPrimary: true,\n    handleClick: handleSubmit,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 13\n    }\n  }, loading ? /*#__PURE__*/React.createElement(\"div\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Loader, {\n    size: 20,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 19\n    }\n  })) : /*#__PURE__*/React.createElement(React.Fragment, null, t('settings.accountsTab.personalDetails.button.saveChanges')))), /*#__PURE__*/React.createElement(Unimodal, {\n    open: open,\n    handleClose: handleClose,\n    hasCloseBtn: true,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 157,\n      columnNumber: 11\n    }\n  }, error.length ? /*#__PURE__*/React.createElement(\"div\", {\n    className: classes.errDiv,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: classes.textError,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Typography, {\n    className: classes.typo,\n    align: \"center\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 162,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(\"strong\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163,\n      columnNumber: 21\n    }\n  }, t('settings.accountsTab.personalDetails.modal.headerErrStrong'), \":\"), ' ', t('settings.accountsTab.personalDetails.modal.headerErr'))), /*#__PURE__*/React.createElement(\"div\", {\n    className: classes.textSecondError,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 172,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Typography, {\n    className: classes.typoSub,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 173,\n      columnNumber: 19\n    }\n  }, t('settings.accountsTab.personalDetails.modal.headerErrStrong'), \": \", error)), /*#__PURE__*/React.createElement(\"div\", {\n    \"data-cy\": \"done\",\n    className: classes.buttonModal,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 180,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(ButtonFilled, {\n    isPrimary: true,\n    isDisabled: false,\n    handleClick: handleClose,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 181,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(React.Fragment, null, t('settings.accountsTab.personalDetails.button.done'))))) : /*#__PURE__*/React.createElement(\"div\", {\n    className: classes.body,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 191,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"img\", {\n    src: \"./icons/userLarge.svg\",\n    alt: \"user\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 192,\n      columnNumber: 17\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: classes.text,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 193,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Typography, {\n    className: classes.typo,\n    align: \"center\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 194,\n      columnNumber: 19\n    }\n  }, t('settings.accountsTab.personalDetails.modal.header'), ' ', /*#__PURE__*/React.createElement(\"strong\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 196,\n      columnNumber: 21\n    }\n  }, t('settings.accountsTab.personalDetails.modal.headerStrong')))), /*#__PURE__*/React.createElement(\"div\", {\n    className: classes.text1,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 203,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Typography, {\n    align: \"center\",\n    className: classes.typo1,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 204,\n      columnNumber: 19\n    }\n  }, t('settings.accountsTab.personalDetails.modal.info'))), /*#__PURE__*/React.createElement(\"div\", {\n    \"data-cy\": \"done\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 208,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(ButtonFilled, {\n    isPrimary: true,\n    isDisabled: false,\n    handleClick: handleClose,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 209,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(React.Fragment, null, t('settings.accountsTab.personalDetails.button.done')))))))));\n};\n\nexport default PersonalDetails;","map":{"version":3,"sources":["/home/raj/go/src/github.com/litmuschaos/litmus/litmus-portal/frontend/src/views/Settings/AccountsTab/PersonalDetails/index.tsx"],"names":["useMutation","useQuery","Typography","React","useState","useSelector","useTranslation","ButtonFilled","Loader","config","Unimodal","GET_USER","UPDATE_DETAILS","getToken","UserDetails","useStyles","PersonalDetails","classes","t","username","state","userData","loading","setLoading","variables","dataA","data","error","setError","name","getUser","email","userName","fullName","personaData","setPersonaData","open","setOpen","handleClose","handleUserChange","e","target","value","handleNameChange","handleEmailChange","onCompleted","onError","message","refetchQueries","query","updateDetails","handleSubmit","fetch","auth","url","method","headers","Authorization","body","JSON","stringify","then","response","json","error_description","user","id","catch","err","console","saveButton","length","errDiv","textError","typo","textSecondError","typoSub","buttonModal","text","text1","typo1"],"mappings":"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","sourcesContent":["import { useMutation, useQuery } from '@apollo/client';\nimport { Typography } from '@material-ui/core';\nimport React, { useState } from 'react';\nimport { useSelector } from 'react-redux';\nimport { useTranslation } from 'react-i18next';\nimport ButtonFilled from '../../../../components/Button/ButtonFilled';\nimport Loader from '../../../../components/Loader';\nimport config from '../../../../config';\nimport Unimodal from '../../../../containers/layouts/Unimodal';\nimport { GET_USER, UPDATE_DETAILS } from '../../../../graphql';\nimport {\n  CurrentUserDedtailsVars,\n  CurrentUserDetails,\n} from '../../../../models/graphql/user';\nimport { UpdateUser } from '../../../../models/redux/user';\nimport { RootState } from '../../../../redux/reducers';\nimport getToken from '../../../../utils/getToken';\nimport UserDetails from '../../UserManagementTab/CreateUser/UserDetails';\nimport useStyles from './styles';\n\ninterface personaData {\n  email: string;\n  userName: string;\n  fullName: string;\n}\n\n// Displays the personals details on the \"accounts\" tab\nconst PersonalDetails: React.FC = () => {\n  const classes = useStyles();\n  const { t } = useTranslation();\n\n  const username = useSelector((state: RootState) => state.userData.username);\n  const [loading, setLoading] = React.useState(false);\n  // Query to get user details\n  const { data: dataA } = useQuery<CurrentUserDetails, CurrentUserDedtailsVars>(\n    GET_USER,\n    { variables: { username } }\n  );\n  const [error, setError] = useState<string>('');\n  const name: string = dataA?.getUser.name ?? '';\n  const email: string = dataA?.getUser.email ?? '';\n  const [personaData, setPersonaData] = React.useState<personaData>({\n    email,\n    userName: username,\n    fullName: name,\n  });\n  // For closing and opening of the modal\n  const [open, setOpen] = React.useState(false);\n  const handleClose = () => {\n    setOpen(false);\n  };\n  const handleUserChange = (e: any) => {\n    setPersonaData({\n      fullName: personaData.fullName,\n      userName: e.target.value,\n      email: personaData.email,\n    });\n  };\n  const handleNameChange = (e: any) => {\n    setPersonaData({\n      fullName: e.target.value,\n      userName: personaData.userName,\n      email: personaData.email,\n    });\n  };\n  const handleEmailChange = (e: any) => {\n    setPersonaData({\n      fullName: personaData.fullName,\n      userName: personaData.userName,\n      email: e.target.value,\n    });\n  };\n  const [updateDetails] = useMutation<UpdateUser>(UPDATE_DETAILS, {\n    onCompleted: () => {\n      setLoading(false);\n      setOpen(true);\n    },\n    onError: (error) => {\n      setLoading(false);\n      setError(error.message as string);\n      setOpen(true);\n    },\n    refetchQueries: [{ query: GET_USER, variables: { username } }],\n  });\n  // Submit entered data to /update endpoint\n  const handleSubmit = () => {\n    setLoading(true);\n    fetch(`${config.auth.url}/update/details`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        Authorization: `Bearer ${getToken()}`,\n      },\n      body: JSON.stringify({\n        username,\n        name: personaData.fullName,\n        email: personaData.email,\n      }),\n    })\n      .then((response) => response.json())\n      .then((data) => {\n        if ('error' in data) {\n          setError(data.error_description as string);\n          setLoading(false);\n          setOpen(true);\n        } else {\n          updateDetails({\n            variables: {\n              user: {\n                id: dataA?.getUser.id,\n                name: personaData.fullName,\n                email: personaData.email,\n              },\n            },\n          });\n        }\n      })\n      .catch((err) => {\n        setError(err.message as string);\n        setOpen(true);\n        setLoading(false);\n        console.error(err);\n      });\n  };\n  return (\n    <div>\n      <form>\n        <UserDetails\n          emailIsDisabled={false}\n          nameIsDisabled={false}\n          nameValue={personaData.fullName}\n          usernameIsDisabled\n          handleNameChange={handleNameChange}\n          emailValue={personaData.email}\n          handleEmailChange={handleEmailChange}\n          userValue={personaData.userName}\n          handleUserChange={handleUserChange}\n        />\n        <div className={classes.saveButton}>\n          <div data-cy=\"save\">\n            <ButtonFilled\n              isDisabled={!(personaData.fullName.length && !loading)}\n              isPrimary\n              handleClick={handleSubmit}\n            >\n              {loading ? (\n                <div>\n                  <Loader size={20} />\n                </div>\n              ) : (\n                <>\n                  {t('settings.accountsTab.personalDetails.button.saveChanges')}\n                </>\n              )}\n            </ButtonFilled>\n          </div>\n          <Unimodal open={open} handleClose={handleClose} hasCloseBtn>\n            {error.length ? (\n              <div className={classes.errDiv}>\n                {/* <img src=\"./icons/checkmark.svg\" alt=\"checkmark\" /> */}\n                <div className={classes.textError}>\n                  <Typography className={classes.typo} align=\"center\">\n                    <strong>\n                      {t(\n                        'settings.accountsTab.personalDetails.modal.headerErrStrong'\n                      )}\n                      :\n                    </strong>{' '}\n                    {t('settings.accountsTab.personalDetails.modal.headerErr')}\n                  </Typography>\n                </div>\n                <div className={classes.textSecondError}>\n                  <Typography className={classes.typoSub}>\n                    {t(\n                      'settings.accountsTab.personalDetails.modal.headerErrStrong'\n                    )}\n                    : {error}\n                  </Typography>\n                </div>\n                <div data-cy=\"done\" className={classes.buttonModal}>\n                  <ButtonFilled\n                    isPrimary\n                    isDisabled={false}\n                    handleClick={handleClose}\n                  >\n                    <>{t('settings.accountsTab.personalDetails.button.done')}</>\n                  </ButtonFilled>\n                </div>\n              </div>\n            ) : (\n              <div className={classes.body}>\n                <img src=\"./icons/userLarge.svg\" alt=\"user\" />\n                <div className={classes.text}>\n                  <Typography className={classes.typo} align=\"center\">\n                    {t('settings.accountsTab.personalDetails.modal.header')}{' '}\n                    <strong>\n                      {t(\n                        'settings.accountsTab.personalDetails.modal.headerStrong'\n                      )}\n                    </strong>\n                  </Typography>\n                </div>\n                <div className={classes.text1}>\n                  <Typography align=\"center\" className={classes.typo1}>\n                    {t('settings.accountsTab.personalDetails.modal.info')}\n                  </Typography>\n                </div>\n                <div data-cy=\"done\">\n                  <ButtonFilled\n                    isPrimary\n                    isDisabled={false}\n                    handleClick={handleClose}\n                  >\n                    <>{t('settings.accountsTab.personalDetails.button.done')}</>\n                  </ButtonFilled>\n                </div>\n              </div>\n            )}\n          </Unimodal>\n        </div>\n      </form>\n    </div>\n  );\n};\nexport default PersonalDetails;\n"]},"metadata":{},"sourceType":"module"}