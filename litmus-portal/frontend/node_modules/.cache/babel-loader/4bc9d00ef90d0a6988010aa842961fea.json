{"ast":null,"code":"/**\n* Copyright 2012-2020, Plotly, Inc.\n* All rights reserved.\n*\n* This source code is licensed under the MIT license found in the\n* LICENSE file in the root directory of this source tree.\n*/\n'use strict';\n\nvar c = require('./constants');\n\nvar d3 = require('d3');\n\nvar gup = require('../../lib/gup');\n\nvar Drawing = require('../../components/drawing');\n\nvar svgUtil = require('../../lib/svg_text_utils');\n\nvar raiseToTop = require('../../lib').raiseToTop;\n\nvar cancelEeaseColumn = require('../../lib').cancelTransition;\n\nvar prepareData = require('./data_preparation_helper');\n\nvar splitData = require('./data_split_helpers');\n\nvar Color = require('../../components/color');\n\nmodule.exports = function plot(gd, wrappedTraceHolders) {\n  var dynamic = !gd._context.staticPlot;\n\n  var table = gd._fullLayout._paper.selectAll('.' + c.cn.table).data(wrappedTraceHolders.map(function (wrappedTraceHolder) {\n    var traceHolder = gup.unwrap(wrappedTraceHolder);\n    var trace = traceHolder.trace;\n    return prepareData(gd, trace);\n  }), gup.keyFun);\n\n  table.exit().remove();\n  table.enter().append('g').classed(c.cn.table, true).attr('overflow', 'visible').style('box-sizing', 'content-box').style('position', 'absolute').style('left', 0).style('overflow', 'visible').style('shape-rendering', 'crispEdges').style('pointer-events', 'all');\n  table.attr('width', function (d) {\n    return d.width + d.size.l + d.size.r;\n  }).attr('height', function (d) {\n    return d.height + d.size.t + d.size.b;\n  }).attr('transform', function (d) {\n    return 'translate(' + d.translateX + ',' + d.translateY + ')';\n  });\n  var tableControlView = table.selectAll('.' + c.cn.tableControlView).data(gup.repeat, gup.keyFun);\n  var cvEnter = tableControlView.enter().append('g').classed(c.cn.tableControlView, true).style('box-sizing', 'content-box');\n\n  if (dynamic) {\n    cvEnter.on('mousemove', function (d) {\n      tableControlView.filter(function (dd) {\n        return d === dd;\n      }).call(renderScrollbarKit, gd);\n    }).on('mousewheel', function (d) {\n      if (d.scrollbarState.wheeling) return;\n      d.scrollbarState.wheeling = true;\n      var newY = d.scrollY + d3.event.deltaY;\n      var noChange = makeDragRow(gd, tableControlView, null, newY)(d);\n\n      if (!noChange) {\n        d3.event.stopPropagation();\n        d3.event.preventDefault();\n      }\n\n      d.scrollbarState.wheeling = false;\n    }).call(renderScrollbarKit, gd, true);\n  }\n\n  tableControlView.attr('transform', function (d) {\n    return 'translate(' + d.size.l + ' ' + d.size.t + ')';\n  }); // scrollBackground merely ensures that mouse events are captured even on crazy fast scrollwheeling\n  // otherwise rendering glitches may occur\n\n  var scrollBackground = tableControlView.selectAll('.' + c.cn.scrollBackground).data(gup.repeat, gup.keyFun);\n  scrollBackground.enter().append('rect').classed(c.cn.scrollBackground, true).attr('fill', 'none');\n  scrollBackground.attr('width', function (d) {\n    return d.width;\n  }).attr('height', function (d) {\n    return d.height;\n  });\n  tableControlView.each(function (d) {\n    Drawing.setClipUrl(d3.select(this), scrollAreaBottomClipKey(gd, d), gd);\n  });\n  var yColumn = tableControlView.selectAll('.' + c.cn.yColumn).data(function (vm) {\n    return vm.columns;\n  }, gup.keyFun);\n  yColumn.enter().append('g').classed(c.cn.yColumn, true);\n  yColumn.exit().remove();\n  yColumn.attr('transform', function (d) {\n    return 'translate(' + d.x + ' 0)';\n  });\n\n  if (dynamic) {\n    yColumn.call(d3.behavior.drag().origin(function (d) {\n      var movedColumn = d3.select(this);\n      easeColumn(movedColumn, d, -c.uplift);\n      raiseToTop(this);\n      d.calcdata.columnDragInProgress = true;\n      renderScrollbarKit(tableControlView.filter(function (dd) {\n        return d.calcdata.key === dd.key;\n      }), gd);\n      return d;\n    }).on('drag', function (d) {\n      var movedColumn = d3.select(this);\n\n      var getter = function getter(dd) {\n        return (d === dd ? d3.event.x : dd.x) + dd.columnWidth / 2;\n      };\n\n      d.x = Math.max(-c.overdrag, Math.min(d.calcdata.width + c.overdrag - d.columnWidth, d3.event.x));\n      var sortableColumns = flatData(yColumn).filter(function (dd) {\n        return dd.calcdata.key === d.calcdata.key;\n      });\n      var newOrder = sortableColumns.sort(function (a, b) {\n        return getter(a) - getter(b);\n      });\n      newOrder.forEach(function (dd, i) {\n        dd.xIndex = i;\n        dd.x = d === dd ? dd.x : dd.xScale(dd);\n      });\n      yColumn.filter(function (dd) {\n        return d !== dd;\n      }).transition().ease(c.transitionEase).duration(c.transitionDuration).attr('transform', function (d) {\n        return 'translate(' + d.x + ' 0)';\n      });\n      movedColumn.call(cancelEeaseColumn).attr('transform', 'translate(' + d.x + ' -' + c.uplift + ' )');\n    }).on('dragend', function (d) {\n      var movedColumn = d3.select(this);\n      var p = d.calcdata;\n      d.x = d.xScale(d);\n      d.calcdata.columnDragInProgress = false;\n      easeColumn(movedColumn, d, 0);\n      columnMoved(gd, p, p.columns.map(function (dd) {\n        return dd.xIndex;\n      }));\n    }));\n  }\n\n  yColumn.each(function (d) {\n    Drawing.setClipUrl(d3.select(this), columnBoundaryClipKey(gd, d), gd);\n  });\n  var columnBlock = yColumn.selectAll('.' + c.cn.columnBlock).data(splitData.splitToPanels, gup.keyFun);\n  columnBlock.enter().append('g').classed(c.cn.columnBlock, true).attr('id', function (d) {\n    return d.key;\n  });\n  columnBlock.style('cursor', function (d) {\n    return d.dragHandle ? 'ew-resize' : d.calcdata.scrollbarState.barWiggleRoom ? 'ns-resize' : 'default';\n  });\n  var headerColumnBlock = columnBlock.filter(headerBlock);\n  var cellsColumnBlock = columnBlock.filter(cellsBlock);\n\n  if (dynamic) {\n    cellsColumnBlock.call(d3.behavior.drag().origin(function (d) {\n      d3.event.stopPropagation();\n      return d;\n    }).on('drag', makeDragRow(gd, tableControlView, -1)).on('dragend', function () {// fixme emit plotly notification\n    }));\n  } // initial rendering: header is rendered first, as it may may have async LaTeX (show header first)\n  // but blocks are _entered_ the way they are due to painter's algo (header on top)\n\n\n  renderColumnCellTree(gd, tableControlView, headerColumnBlock, columnBlock);\n  renderColumnCellTree(gd, tableControlView, cellsColumnBlock, columnBlock);\n  var scrollAreaClip = tableControlView.selectAll('.' + c.cn.scrollAreaClip).data(gup.repeat, gup.keyFun);\n  scrollAreaClip.enter().append('clipPath').classed(c.cn.scrollAreaClip, true).attr('id', function (d) {\n    return scrollAreaBottomClipKey(gd, d);\n  });\n  var scrollAreaClipRect = scrollAreaClip.selectAll('.' + c.cn.scrollAreaClipRect).data(gup.repeat, gup.keyFun);\n  scrollAreaClipRect.enter().append('rect').classed(c.cn.scrollAreaClipRect, true).attr('x', -c.overdrag).attr('y', -c.uplift).attr('fill', 'none');\n  scrollAreaClipRect.attr('width', function (d) {\n    return d.width + 2 * c.overdrag;\n  }).attr('height', function (d) {\n    return d.height + c.uplift;\n  });\n  var columnBoundary = yColumn.selectAll('.' + c.cn.columnBoundary).data(gup.repeat, gup.keyFun);\n  columnBoundary.enter().append('g').classed(c.cn.columnBoundary, true);\n  var columnBoundaryClippath = yColumn.selectAll('.' + c.cn.columnBoundaryClippath).data(gup.repeat, gup.keyFun); // SVG spec doesn't mandate wrapping into a <defs> and doesn't seem to cause a speed difference\n\n  columnBoundaryClippath.enter().append('clipPath').classed(c.cn.columnBoundaryClippath, true);\n  columnBoundaryClippath.attr('id', function (d) {\n    return columnBoundaryClipKey(gd, d);\n  });\n  var columnBoundaryRect = columnBoundaryClippath.selectAll('.' + c.cn.columnBoundaryRect).data(gup.repeat, gup.keyFun);\n  columnBoundaryRect.enter().append('rect').classed(c.cn.columnBoundaryRect, true).attr('fill', 'none');\n  columnBoundaryRect.attr('width', function (d) {\n    return d.columnWidth + 2 * roundHalfWidth(d);\n  }).attr('height', function (d) {\n    return d.calcdata.height + 2 * roundHalfWidth(d) + c.uplift;\n  }).attr('x', function (d) {\n    return -roundHalfWidth(d);\n  }).attr('y', function (d) {\n    return -roundHalfWidth(d);\n  });\n  updateBlockYPosition(null, cellsColumnBlock, tableControlView);\n};\n\nfunction roundHalfWidth(d) {\n  return Math.ceil(d.calcdata.maxLineWidth / 2);\n}\n\nfunction scrollAreaBottomClipKey(gd, d) {\n  return 'clip' + gd._fullLayout._uid + '_scrollAreaBottomClip_' + d.key;\n}\n\nfunction columnBoundaryClipKey(gd, d) {\n  return 'clip' + gd._fullLayout._uid + '_columnBoundaryClippath_' + d.calcdata.key + '_' + d.specIndex;\n}\n\nfunction flatData(selection) {\n  return [].concat.apply([], selection.map(function (g) {\n    return g;\n  })).map(function (g) {\n    return g.__data__;\n  });\n}\n\nfunction renderScrollbarKit(tableControlView, gd, bypassVisibleBar) {\n  function calcTotalHeight(d) {\n    var blocks = d.rowBlocks;\n    return firstRowAnchor(blocks, blocks.length - 1) + (blocks.length ? rowsHeight(blocks[blocks.length - 1], Infinity) : 1);\n  }\n\n  var scrollbarKit = tableControlView.selectAll('.' + c.cn.scrollbarKit).data(gup.repeat, gup.keyFun);\n  scrollbarKit.enter().append('g').classed(c.cn.scrollbarKit, true).style('shape-rendering', 'geometricPrecision');\n  scrollbarKit.each(function (d) {\n    var s = d.scrollbarState;\n    s.totalHeight = calcTotalHeight(d);\n    s.scrollableAreaHeight = d.groupHeight - headerHeight(d);\n    s.currentlyVisibleHeight = Math.min(s.totalHeight, s.scrollableAreaHeight);\n    s.ratio = s.currentlyVisibleHeight / s.totalHeight;\n    s.barLength = Math.max(s.ratio * s.currentlyVisibleHeight, c.goldenRatio * c.scrollbarWidth);\n    s.barWiggleRoom = s.currentlyVisibleHeight - s.barLength;\n    s.wiggleRoom = Math.max(0, s.totalHeight - s.scrollableAreaHeight);\n    s.topY = s.barWiggleRoom === 0 ? 0 : d.scrollY / s.wiggleRoom * s.barWiggleRoom;\n    s.bottomY = s.topY + s.barLength;\n    s.dragMultiplier = s.wiggleRoom / s.barWiggleRoom;\n  }).attr('transform', function (d) {\n    var xPosition = d.width + c.scrollbarWidth / 2 + c.scrollbarOffset;\n    return 'translate(' + xPosition + ' ' + headerHeight(d) + ')';\n  });\n  var scrollbar = scrollbarKit.selectAll('.' + c.cn.scrollbar).data(gup.repeat, gup.keyFun);\n  scrollbar.enter().append('g').classed(c.cn.scrollbar, true);\n  var scrollbarSlider = scrollbar.selectAll('.' + c.cn.scrollbarSlider).data(gup.repeat, gup.keyFun);\n  scrollbarSlider.enter().append('g').classed(c.cn.scrollbarSlider, true);\n  scrollbarSlider.attr('transform', function (d) {\n    return 'translate(0 ' + (d.scrollbarState.topY || 0) + ')';\n  });\n  var scrollbarGlyph = scrollbarSlider.selectAll('.' + c.cn.scrollbarGlyph).data(gup.repeat, gup.keyFun);\n  scrollbarGlyph.enter().append('line').classed(c.cn.scrollbarGlyph, true).attr('stroke', 'black').attr('stroke-width', c.scrollbarWidth).attr('stroke-linecap', 'round').attr('y1', c.scrollbarWidth / 2);\n  scrollbarGlyph.attr('y2', function (d) {\n    return d.scrollbarState.barLength - c.scrollbarWidth / 2;\n  }).attr('stroke-opacity', function (d) {\n    return d.columnDragInProgress || !d.scrollbarState.barWiggleRoom || bypassVisibleBar ? 0 : 0.4;\n  }); // cancel transition: possible pending (also, delayed) transition\n\n  scrollbarGlyph.transition().delay(0).duration(0);\n  scrollbarGlyph.transition().delay(c.scrollbarHideDelay).duration(c.scrollbarHideDuration).attr('stroke-opacity', 0);\n  var scrollbarCaptureZone = scrollbar.selectAll('.' + c.cn.scrollbarCaptureZone).data(gup.repeat, gup.keyFun);\n  scrollbarCaptureZone.enter().append('line').classed(c.cn.scrollbarCaptureZone, true).attr('stroke', 'white').attr('stroke-opacity', 0.01) // some browser might get rid of a 0 opacity element\n  .attr('stroke-width', c.scrollbarCaptureWidth).attr('stroke-linecap', 'butt').attr('y1', 0).on('mousedown', function (d) {\n    var y = d3.event.y;\n    var bbox = this.getBoundingClientRect();\n    var s = d.scrollbarState;\n    var pixelVal = y - bbox.top;\n    var inverseScale = d3.scale.linear().domain([0, s.scrollableAreaHeight]).range([0, s.totalHeight]).clamp(true);\n\n    if (!(s.topY <= pixelVal && pixelVal <= s.bottomY)) {\n      makeDragRow(gd, tableControlView, null, inverseScale(pixelVal - s.barLength / 2))(d);\n    }\n  }).call(d3.behavior.drag().origin(function (d) {\n    d3.event.stopPropagation();\n    d.scrollbarState.scrollbarScrollInProgress = true;\n    return d;\n  }).on('drag', makeDragRow(gd, tableControlView)).on('dragend', function () {// fixme emit Plotly event\n  }));\n  scrollbarCaptureZone.attr('y2', function (d) {\n    return d.scrollbarState.scrollableAreaHeight;\n  }); // Remove scroll glyph and capture zone on static plots\n  // as they don't render properly when converted to PDF\n  // in the Chrome PDF viewer\n  // https://github.com/plotly/streambed/issues/11618\n\n  if (gd._context.staticPlot) {\n    scrollbarGlyph.remove();\n    scrollbarCaptureZone.remove();\n  }\n}\n\nfunction renderColumnCellTree(gd, tableControlView, columnBlock, allColumnBlock) {\n  // fixme this perf hotspot\n  // this is performance critical code as scrolling calls it on every revolver switch\n  // it appears sufficiently fast but there are plenty of low-hanging fruits for performance optimization\n  var columnCells = renderColumnCells(columnBlock);\n  var columnCell = renderColumnCell(columnCells);\n  supplyStylingValues(columnCell);\n  var cellRect = renderCellRect(columnCell);\n  sizeAndStyleRect(cellRect);\n  var cellTextHolder = renderCellTextHolder(columnCell);\n  var cellText = renderCellText(cellTextHolder);\n  setFont(cellText);\n  populateCellText(cellText, tableControlView, allColumnBlock, gd); // doing this at the end when text, and text stlying are set\n\n  setCellHeightAndPositionY(columnCell);\n}\n\nfunction renderColumnCells(columnBlock) {\n  var columnCells = columnBlock.selectAll('.' + c.cn.columnCells).data(gup.repeat, gup.keyFun);\n  columnCells.enter().append('g').classed(c.cn.columnCells, true);\n  columnCells.exit().remove();\n  return columnCells;\n}\n\nfunction renderColumnCell(columnCells) {\n  var columnCell = columnCells.selectAll('.' + c.cn.columnCell).data(splitData.splitToCells, function (d) {\n    return d.keyWithinBlock;\n  });\n  columnCell.enter().append('g').classed(c.cn.columnCell, true);\n  columnCell.exit().remove();\n  return columnCell;\n}\n\nfunction renderCellRect(columnCell) {\n  var cellRect = columnCell.selectAll('.' + c.cn.cellRect).data(gup.repeat, function (d) {\n    return d.keyWithinBlock;\n  });\n  cellRect.enter().append('rect').classed(c.cn.cellRect, true);\n  return cellRect;\n}\n\nfunction renderCellText(cellTextHolder) {\n  var cellText = cellTextHolder.selectAll('.' + c.cn.cellText).data(gup.repeat, function (d) {\n    return d.keyWithinBlock;\n  });\n  cellText.enter().append('text').classed(c.cn.cellText, true).style('cursor', function () {\n    return 'auto';\n  }).on('mousedown', function () {\n    d3.event.stopPropagation();\n  });\n  return cellText;\n}\n\nfunction renderCellTextHolder(columnCell) {\n  var cellTextHolder = columnCell.selectAll('.' + c.cn.cellTextHolder).data(gup.repeat, function (d) {\n    return d.keyWithinBlock;\n  });\n  cellTextHolder.enter().append('g').classed(c.cn.cellTextHolder, true).style('shape-rendering', 'geometricPrecision');\n  return cellTextHolder;\n}\n\nfunction supplyStylingValues(columnCell) {\n  columnCell.each(function (d, i) {\n    var spec = d.calcdata.cells.font;\n    var col = d.column.specIndex;\n    var font = {\n      size: gridPick(spec.size, col, i),\n      color: gridPick(spec.color, col, i),\n      family: gridPick(spec.family, col, i)\n    };\n    d.rowNumber = d.key;\n    d.align = gridPick(d.calcdata.cells.align, col, i);\n    d.cellBorderWidth = gridPick(d.calcdata.cells.line.width, col, i);\n    d.font = font;\n  });\n}\n\nfunction setFont(cellText) {\n  cellText.each(function (d) {\n    Drawing.font(d3.select(this), d.font);\n  });\n}\n\nfunction sizeAndStyleRect(cellRect) {\n  cellRect.attr('width', function (d) {\n    return d.column.columnWidth;\n  }).attr('stroke-width', function (d) {\n    return d.cellBorderWidth;\n  }).each(function (d) {\n    var atomicSelection = d3.select(this);\n    Color.stroke(atomicSelection, gridPick(d.calcdata.cells.line.color, d.column.specIndex, d.rowNumber));\n    Color.fill(atomicSelection, gridPick(d.calcdata.cells.fill.color, d.column.specIndex, d.rowNumber));\n  });\n}\n\nfunction populateCellText(cellText, tableControlView, allColumnBlock, gd) {\n  cellText.text(function (d) {\n    var col = d.column.specIndex;\n    var row = d.rowNumber;\n    var userSuppliedContent = d.value;\n    var stringSupplied = typeof userSuppliedContent === 'string';\n    var hasBreaks = stringSupplied && userSuppliedContent.match(/<br>/i);\n    var userBrokenText = !stringSupplied || hasBreaks;\n    d.mayHaveMarkup = stringSupplied && userSuppliedContent.match(/[<&>]/);\n    var latex = isLatex(userSuppliedContent);\n    d.latex = latex;\n    var prefix = latex ? '' : gridPick(d.calcdata.cells.prefix, col, row) || '';\n    var suffix = latex ? '' : gridPick(d.calcdata.cells.suffix, col, row) || '';\n    var format = latex ? null : gridPick(d.calcdata.cells.format, col, row) || null;\n    var prefixSuffixedText = prefix + (format ? d3.format(format)(d.value) : d.value) + suffix;\n    var hasWrapSplitCharacter;\n    d.wrappingNeeded = !d.wrapped && !userBrokenText && !latex && (hasWrapSplitCharacter = hasWrapCharacter(prefixSuffixedText));\n    d.cellHeightMayIncrease = hasBreaks || latex || d.mayHaveMarkup || (hasWrapSplitCharacter === void 0 ? hasWrapCharacter(prefixSuffixedText) : hasWrapSplitCharacter);\n    d.needsConvertToTspans = d.mayHaveMarkup || d.wrappingNeeded || d.latex;\n    var textToRender;\n\n    if (d.wrappingNeeded) {\n      var hrefPreservedText = c.wrapSplitCharacter === ' ' ? prefixSuffixedText.replace(/<a href=/ig, '<a_href=') : prefixSuffixedText;\n      var fragments = hrefPreservedText.split(c.wrapSplitCharacter);\n      var hrefRestoredFragments = c.wrapSplitCharacter === ' ' ? fragments.map(function (frag) {\n        return frag.replace(/<a_href=/ig, '<a href=');\n      }) : fragments;\n      d.fragments = hrefRestoredFragments.map(function (f) {\n        return {\n          text: f,\n          width: null\n        };\n      });\n      d.fragments.push({\n        fragment: c.wrapSpacer,\n        width: null\n      });\n      textToRender = hrefRestoredFragments.join(c.lineBreaker) + c.lineBreaker + c.wrapSpacer;\n    } else {\n      delete d.fragments;\n      textToRender = prefixSuffixedText;\n    }\n\n    return textToRender;\n  }).attr('dy', function (d) {\n    return d.needsConvertToTspans ? 0 : '0.75em';\n  }).each(function (d) {\n    var element = this;\n    var selection = d3.select(element); // finalize what's in the DOM\n\n    var renderCallback = d.wrappingNeeded ? wrapTextMaker : updateYPositionMaker;\n\n    if (d.needsConvertToTspans) {\n      svgUtil.convertToTspans(selection, gd, renderCallback(allColumnBlock, element, tableControlView, gd, d));\n    } else {\n      d3.select(element.parentNode) // basic cell adjustment - compliance with `cellPad`\n      .attr('transform', function (d) {\n        return 'translate(' + xPosition(d) + ' ' + c.cellPad + ')';\n      }).attr('text-anchor', function (d) {\n        return {\n          left: 'start',\n          center: 'middle',\n          right: 'end'\n        }[d.align];\n      });\n    }\n  });\n}\n\nfunction isLatex(content) {\n  return typeof content === 'string' && content.match(c.latexCheck);\n}\n\nfunction hasWrapCharacter(text) {\n  return text.indexOf(c.wrapSplitCharacter) !== -1;\n}\n\nfunction columnMoved(gd, calcdata, indices) {\n  var o = calcdata.gdColumnsOriginalOrder;\n  calcdata.gdColumns.sort(function (a, b) {\n    return indices[o.indexOf(a)] - indices[o.indexOf(b)];\n  });\n  calcdata.columnorder = indices; // TODO: there's no data here, but also this reordering is not reflected\n  // in gd.data or even gd._fullData.\n  // For now I will not attempt to persist this in _preGUI\n\n  gd.emit('plotly_restyle');\n}\n\nfunction gridPick(spec, col, row) {\n  if (Array.isArray(spec)) {\n    var column = spec[Math.min(col, spec.length - 1)];\n\n    if (Array.isArray(column)) {\n      return column[Math.min(row, column.length - 1)];\n    } else {\n      return column;\n    }\n  } else {\n    return spec;\n  }\n}\n\nfunction easeColumn(selection, d, y) {\n  selection.transition().ease(c.releaseTransitionEase).duration(c.releaseTransitionDuration).attr('transform', 'translate(' + d.x + ' ' + y + ')');\n}\n\nfunction cellsBlock(d) {\n  return d.type === 'cells';\n}\n\nfunction headerBlock(d) {\n  return d.type === 'header';\n}\n/**\n * Revolver panel and cell contents layouting\n */\n\n\nfunction headerHeight(d) {\n  var headerBlocks = d.rowBlocks.length ? d.rowBlocks[0].auxiliaryBlocks : [];\n  return headerBlocks.reduce(function (p, n) {\n    return p + rowsHeight(n, Infinity);\n  }, 0);\n}\n\nfunction findPagesAndCacheHeights(blocks, scrollY, scrollHeight) {\n  var pages = [];\n  var pTop = 0;\n\n  for (var blockIndex = 0; blockIndex < blocks.length; blockIndex++) {\n    var block = blocks[blockIndex];\n    var blockRows = block.rows;\n    var rowsHeight = 0;\n\n    for (var i = 0; i < blockRows.length; i++) {\n      rowsHeight += blockRows[i].rowHeight;\n    } // caching allRowsHeight on the block - it's safe as this function is always called from within the code part\n    // that handles increases to row heights\n\n\n    block.allRowsHeight = rowsHeight;\n    var pBottom = pTop + rowsHeight;\n    var windowTop = scrollY;\n    var windowBottom = windowTop + scrollHeight;\n\n    if (windowTop < pBottom && windowBottom > pTop) {\n      pages.push(blockIndex);\n    }\n\n    pTop += rowsHeight; // consider this nice final optimization; put it in `for` condition - caveat, currently the\n    // block.allRowsHeight relies on being invalidated, so enabling this opt may not be safe\n    // if(pages.length > 1) break;\n  }\n\n  return pages;\n}\n\nfunction updateBlockYPosition(gd, cellsColumnBlock, tableControlView) {\n  var d = flatData(cellsColumnBlock)[0];\n  if (d === undefined) return;\n  var blocks = d.rowBlocks;\n  var calcdata = d.calcdata;\n  var bottom = firstRowAnchor(blocks, blocks.length);\n  var scrollHeight = d.calcdata.groupHeight - headerHeight(d);\n  var scrollY = calcdata.scrollY = Math.max(0, Math.min(bottom - scrollHeight, calcdata.scrollY));\n  var pages = findPagesAndCacheHeights(blocks, scrollY, scrollHeight);\n\n  if (pages.length === 1) {\n    if (pages[0] === blocks.length - 1) {\n      pages.unshift(pages[0] - 1);\n    } else {\n      pages.push(pages[0] + 1);\n    }\n  } // make phased out page jump by 2 while leaving stationary page intact\n\n\n  if (pages[0] % 2) {\n    pages.reverse();\n  }\n\n  cellsColumnBlock.each(function (d, i) {\n    // these values will also be needed when a block is translated again due to growing cell height\n    d.page = pages[i];\n    d.scrollY = scrollY;\n  });\n  cellsColumnBlock.attr('transform', function (d) {\n    var yTranslate = firstRowAnchor(d.rowBlocks, d.page) - d.scrollY;\n    return 'translate(0 ' + yTranslate + ')';\n  }); // conditionally rerendering panel 0 and 1\n\n  if (gd) {\n    conditionalPanelRerender(gd, tableControlView, cellsColumnBlock, pages, d.prevPages, d, 0);\n    conditionalPanelRerender(gd, tableControlView, cellsColumnBlock, pages, d.prevPages, d, 1);\n    renderScrollbarKit(tableControlView, gd);\n  }\n}\n\nfunction makeDragRow(gd, allTableControlView, optionalMultiplier, optionalPosition) {\n  return function dragRow(eventD) {\n    // may come from whichever DOM event target: drag, wheel, bar... eventD corresponds to event target\n    var d = eventD.calcdata ? eventD.calcdata : eventD;\n    var tableControlView = allTableControlView.filter(function (dd) {\n      return d.key === dd.key;\n    });\n    var multiplier = optionalMultiplier || d.scrollbarState.dragMultiplier;\n    var initialScrollY = d.scrollY;\n    d.scrollY = optionalPosition === void 0 ? d.scrollY + multiplier * d3.event.dy : optionalPosition;\n    var cellsColumnBlock = tableControlView.selectAll('.' + c.cn.yColumn).selectAll('.' + c.cn.columnBlock).filter(cellsBlock);\n    updateBlockYPosition(gd, cellsColumnBlock, tableControlView); // return false if we've \"used\" the scroll, ie it did something,\n    // so the event shouldn't bubble (if appropriate)\n\n    return d.scrollY === initialScrollY;\n  };\n}\n\nfunction conditionalPanelRerender(gd, tableControlView, cellsColumnBlock, pages, prevPages, d, revolverIndex) {\n  var shouldComponentUpdate = pages[revolverIndex] !== prevPages[revolverIndex];\n\n  if (shouldComponentUpdate) {\n    clearTimeout(d.currentRepaint[revolverIndex]);\n    d.currentRepaint[revolverIndex] = setTimeout(function () {\n      // setTimeout might lag rendering but yields a smoother scroll, because fast scrolling makes\n      // some repaints invisible ie. wasteful (DOM work blocks the main thread)\n      var toRerender = cellsColumnBlock.filter(function (d, i) {\n        return i === revolverIndex && pages[i] !== prevPages[i];\n      });\n      renderColumnCellTree(gd, tableControlView, toRerender, cellsColumnBlock);\n      prevPages[revolverIndex] = pages[revolverIndex];\n    });\n  }\n}\n\nfunction wrapTextMaker(columnBlock, element, tableControlView, gd) {\n  return function wrapText() {\n    var cellTextHolder = d3.select(element.parentNode);\n    cellTextHolder.each(function (d) {\n      var fragments = d.fragments;\n      cellTextHolder.selectAll('tspan.line').each(function (dd, i) {\n        fragments[i].width = this.getComputedTextLength();\n      }); // last element is only for measuring the separator character, so it's ignored:\n\n      var separatorLength = fragments[fragments.length - 1].width;\n      var rest = fragments.slice(0, -1);\n      var currentRow = [];\n      var currentAddition, currentAdditionLength;\n      var currentRowLength = 0;\n      var rowLengthLimit = d.column.columnWidth - 2 * c.cellPad;\n      d.value = '';\n\n      while (rest.length) {\n        currentAddition = rest.shift();\n        currentAdditionLength = currentAddition.width + separatorLength;\n\n        if (currentRowLength + currentAdditionLength > rowLengthLimit) {\n          d.value += currentRow.join(c.wrapSpacer) + c.lineBreaker;\n          currentRow = [];\n          currentRowLength = 0;\n        }\n\n        currentRow.push(currentAddition.text);\n        currentRowLength += currentAdditionLength;\n      }\n\n      if (currentRowLength) {\n        d.value += currentRow.join(c.wrapSpacer);\n      }\n\n      d.wrapped = true;\n    }); // the pre-wrapped text was rendered only for the text measurements\n\n    cellTextHolder.selectAll('tspan.line').remove(); // resupply text, now wrapped\n\n    populateCellText(cellTextHolder.select('.' + c.cn.cellText), tableControlView, columnBlock, gd);\n    d3.select(element.parentNode.parentNode).call(setCellHeightAndPositionY);\n  };\n}\n\nfunction updateYPositionMaker(columnBlock, element, tableControlView, gd, d) {\n  return function updateYPosition() {\n    if (d.settledY) return;\n    var cellTextHolder = d3.select(element.parentNode);\n    var l = getBlock(d);\n    var rowIndex = d.key - l.firstRowIndex;\n    var declaredRowHeight = l.rows[rowIndex].rowHeight;\n    var requiredHeight = d.cellHeightMayIncrease ? element.parentNode.getBoundingClientRect().height + 2 * c.cellPad : declaredRowHeight;\n    var finalHeight = Math.max(requiredHeight, declaredRowHeight);\n    var increase = finalHeight - l.rows[rowIndex].rowHeight;\n\n    if (increase) {\n      // current row height increased\n      l.rows[rowIndex].rowHeight = finalHeight;\n      columnBlock.selectAll('.' + c.cn.columnCell).call(setCellHeightAndPositionY);\n      updateBlockYPosition(null, columnBlock.filter(cellsBlock), 0); // if d.column.type === 'header', then the scrollbar has to be pushed downward to the scrollable area\n      // if d.column.type === 'cells', it can still be relevant if total scrolling content height is less than the\n      //                               scrollable window, as increases to row heights may need scrollbar updates\n\n      renderScrollbarKit(tableControlView, gd, true);\n    }\n\n    cellTextHolder.attr('transform', function () {\n      // this code block is only invoked for items where d.cellHeightMayIncrease is truthy\n      var element = this;\n      var columnCellElement = element.parentNode;\n      var box = columnCellElement.getBoundingClientRect();\n      var rectBox = d3.select(element.parentNode).select('.' + c.cn.cellRect).node().getBoundingClientRect();\n      var currentTransform = element.transform.baseVal.consolidate();\n      var yPosition = rectBox.top - box.top + (currentTransform ? currentTransform.matrix.f : c.cellPad);\n      return 'translate(' + xPosition(d, d3.select(element.parentNode).select('.' + c.cn.cellTextHolder).node().getBoundingClientRect().width) + ' ' + yPosition + ')';\n    });\n    d.settledY = true;\n  };\n}\n\nfunction xPosition(d, optionalWidth) {\n  switch (d.align) {\n    case 'left':\n      return c.cellPad;\n\n    case 'right':\n      return d.column.columnWidth - (optionalWidth || 0) - c.cellPad;\n\n    case 'center':\n      return (d.column.columnWidth - (optionalWidth || 0)) / 2;\n\n    default:\n      return c.cellPad;\n  }\n}\n\nfunction setCellHeightAndPositionY(columnCell) {\n  columnCell.attr('transform', function (d) {\n    var headerHeight = d.rowBlocks[0].auxiliaryBlocks.reduce(function (p, n) {\n      return p + rowsHeight(n, Infinity);\n    }, 0);\n    var l = getBlock(d);\n    var rowAnchor = rowsHeight(l, d.key);\n    var yOffset = rowAnchor + headerHeight;\n    return 'translate(0 ' + yOffset + ')';\n  }).selectAll('.' + c.cn.cellRect).attr('height', function (d) {\n    return getRow(getBlock(d), d.key).rowHeight;\n  });\n}\n\nfunction firstRowAnchor(blocks, page) {\n  var total = 0;\n\n  for (var i = page - 1; i >= 0; i--) {\n    total += allRowsHeight(blocks[i]);\n  }\n\n  return total;\n}\n\nfunction rowsHeight(rowBlock, key) {\n  var total = 0;\n\n  for (var i = 0; i < rowBlock.rows.length && rowBlock.rows[i].rowIndex < key; i++) {\n    total += rowBlock.rows[i].rowHeight;\n  }\n\n  return total;\n}\n\nfunction allRowsHeight(rowBlock) {\n  var cached = rowBlock.allRowsHeight;\n\n  if (cached !== void 0) {\n    return cached;\n  }\n\n  var total = 0;\n\n  for (var i = 0; i < rowBlock.rows.length; i++) {\n    total += rowBlock.rows[i].rowHeight;\n  }\n\n  rowBlock.allRowsHeight = total;\n  return total;\n}\n\nfunction getBlock(d) {\n  return d.rowBlocks[d.page];\n}\n\nfunction getRow(l, i) {\n  return l.rows[i - l.firstRowIndex];\n}","map":{"version":3,"sources":["/home/raj/go/src/github.com/litmuschaos/litmus/litmus-portal/frontend/node_modules/plotly.js/src/traces/table/plot.js"],"names":["c","require","d3","gup","Drawing","svgUtil","raiseToTop","cancelEeaseColumn","cancelTransition","prepareData","splitData","Color","module","exports","plot","gd","wrappedTraceHolders","dynamic","_context","staticPlot","table","_fullLayout","_paper","selectAll","cn","data","map","wrappedTraceHolder","traceHolder","unwrap","trace","keyFun","exit","remove","enter","append","classed","attr","style","d","width","size","l","r","height","t","b","translateX","translateY","tableControlView","repeat","cvEnter","on","filter","dd","call","renderScrollbarKit","scrollbarState","wheeling","newY","scrollY","event","deltaY","noChange","makeDragRow","stopPropagation","preventDefault","scrollBackground","each","setClipUrl","select","scrollAreaBottomClipKey","yColumn","vm","columns","x","behavior","drag","origin","movedColumn","easeColumn","uplift","calcdata","columnDragInProgress","key","getter","columnWidth","Math","max","overdrag","min","sortableColumns","flatData","newOrder","sort","a","forEach","i","xIndex","xScale","transition","ease","transitionEase","duration","transitionDuration","p","columnMoved","columnBoundaryClipKey","columnBlock","splitToPanels","dragHandle","barWiggleRoom","headerColumnBlock","headerBlock","cellsColumnBlock","cellsBlock","renderColumnCellTree","scrollAreaClip","scrollAreaClipRect","columnBoundary","columnBoundaryClippath","columnBoundaryRect","roundHalfWidth","updateBlockYPosition","ceil","maxLineWidth","_uid","specIndex","selection","concat","apply","g","__data__","bypassVisibleBar","calcTotalHeight","blocks","rowBlocks","firstRowAnchor","length","rowsHeight","Infinity","scrollbarKit","s","totalHeight","scrollableAreaHeight","groupHeight","headerHeight","currentlyVisibleHeight","ratio","barLength","goldenRatio","scrollbarWidth","wiggleRoom","topY","bottomY","dragMultiplier","xPosition","scrollbarOffset","scrollbar","scrollbarSlider","scrollbarGlyph","delay","scrollbarHideDelay","scrollbarHideDuration","scrollbarCaptureZone","scrollbarCaptureWidth","y","bbox","getBoundingClientRect","pixelVal","top","inverseScale","scale","linear","domain","range","clamp","scrollbarScrollInProgress","allColumnBlock","columnCells","renderColumnCells","columnCell","renderColumnCell","supplyStylingValues","cellRect","renderCellRect","sizeAndStyleRect","cellTextHolder","renderCellTextHolder","cellText","renderCellText","setFont","populateCellText","setCellHeightAndPositionY","splitToCells","keyWithinBlock","spec","cells","font","col","column","gridPick","color","family","rowNumber","align","cellBorderWidth","line","atomicSelection","stroke","fill","text","row","userSuppliedContent","value","stringSupplied","hasBreaks","match","userBrokenText","mayHaveMarkup","latex","isLatex","prefix","suffix","format","prefixSuffixedText","hasWrapSplitCharacter","wrappingNeeded","wrapped","hasWrapCharacter","cellHeightMayIncrease","needsConvertToTspans","textToRender","hrefPreservedText","wrapSplitCharacter","replace","fragments","split","hrefRestoredFragments","frag","f","push","fragment","wrapSpacer","join","lineBreaker","element","renderCallback","wrapTextMaker","updateYPositionMaker","convertToTspans","parentNode","cellPad","left","center","right","content","latexCheck","indexOf","indices","o","gdColumnsOriginalOrder","gdColumns","columnorder","emit","Array","isArray","releaseTransitionEase","releaseTransitionDuration","type","headerBlocks","auxiliaryBlocks","reduce","n","findPagesAndCacheHeights","scrollHeight","pages","pTop","blockIndex","block","blockRows","rows","rowHeight","allRowsHeight","pBottom","windowTop","windowBottom","undefined","bottom","unshift","reverse","page","yTranslate","conditionalPanelRerender","prevPages","allTableControlView","optionalMultiplier","optionalPosition","dragRow","eventD","multiplier","initialScrollY","dy","revolverIndex","shouldComponentUpdate","clearTimeout","currentRepaint","setTimeout","toRerender","wrapText","getComputedTextLength","separatorLength","rest","slice","currentRow","currentAddition","currentAdditionLength","currentRowLength","rowLengthLimit","shift","updateYPosition","settledY","getBlock","rowIndex","firstRowIndex","declaredRowHeight","requiredHeight","finalHeight","increase","columnCellElement","box","rectBox","node","currentTransform","transform","baseVal","consolidate","yPosition","matrix","optionalWidth","rowAnchor","yOffset","getRow","total","rowBlock","cached"],"mappings":"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","sourcesContent":["/**\n* Copyright 2012-2020, Plotly, Inc.\n* All rights reserved.\n*\n* This source code is licensed under the MIT license found in the\n* LICENSE file in the root directory of this source tree.\n*/\n\n'use strict';\n\nvar c = require('./constants');\nvar d3 = require('d3');\nvar gup = require('../../lib/gup');\nvar Drawing = require('../../components/drawing');\nvar svgUtil = require('../../lib/svg_text_utils');\nvar raiseToTop = require('../../lib').raiseToTop;\nvar cancelEeaseColumn = require('../../lib').cancelTransition;\nvar prepareData = require('./data_preparation_helper');\nvar splitData = require('./data_split_helpers');\nvar Color = require('../../components/color');\n\nmodule.exports = function plot(gd, wrappedTraceHolders) {\n    var dynamic = !gd._context.staticPlot;\n\n    var table = gd._fullLayout._paper.selectAll('.' + c.cn.table)\n        .data(wrappedTraceHolders.map(function(wrappedTraceHolder) {\n            var traceHolder = gup.unwrap(wrappedTraceHolder);\n            var trace = traceHolder.trace;\n            return prepareData(gd, trace);\n        }), gup.keyFun);\n\n    table.exit().remove();\n\n    table.enter()\n        .append('g')\n        .classed(c.cn.table, true)\n        .attr('overflow', 'visible')\n        .style('box-sizing', 'content-box')\n        .style('position', 'absolute')\n        .style('left', 0)\n        .style('overflow', 'visible')\n        .style('shape-rendering', 'crispEdges')\n        .style('pointer-events', 'all');\n\n    table\n        .attr('width', function(d) {return d.width + d.size.l + d.size.r;})\n        .attr('height', function(d) {return d.height + d.size.t + d.size.b;})\n        .attr('transform', function(d) {\n            return 'translate(' + d.translateX + ',' + d.translateY + ')';\n        });\n\n    var tableControlView = table.selectAll('.' + c.cn.tableControlView)\n        .data(gup.repeat, gup.keyFun);\n\n    var cvEnter = tableControlView.enter()\n        .append('g')\n        .classed(c.cn.tableControlView, true)\n        .style('box-sizing', 'content-box');\n    if(dynamic) {\n        cvEnter\n            .on('mousemove', function(d) {\n                tableControlView\n                    .filter(function(dd) {return d === dd;})\n                    .call(renderScrollbarKit, gd);\n            })\n            .on('mousewheel', function(d) {\n                if(d.scrollbarState.wheeling) return;\n                d.scrollbarState.wheeling = true;\n                var newY = d.scrollY + d3.event.deltaY;\n                var noChange = makeDragRow(gd, tableControlView, null, newY)(d);\n                if(!noChange) {\n                    d3.event.stopPropagation();\n                    d3.event.preventDefault();\n                }\n                d.scrollbarState.wheeling = false;\n            })\n            .call(renderScrollbarKit, gd, true);\n    }\n\n    tableControlView\n        .attr('transform', function(d) {return 'translate(' + d.size.l + ' ' + d.size.t + ')';});\n\n    // scrollBackground merely ensures that mouse events are captured even on crazy fast scrollwheeling\n    // otherwise rendering glitches may occur\n    var scrollBackground = tableControlView.selectAll('.' + c.cn.scrollBackground)\n        .data(gup.repeat, gup.keyFun);\n\n    scrollBackground.enter()\n        .append('rect')\n        .classed(c.cn.scrollBackground, true)\n        .attr('fill', 'none');\n\n    scrollBackground\n        .attr('width', function(d) {return d.width;})\n        .attr('height', function(d) {return d.height;});\n\n    tableControlView.each(function(d) {\n        Drawing.setClipUrl(d3.select(this), scrollAreaBottomClipKey(gd, d), gd);\n    });\n\n    var yColumn = tableControlView.selectAll('.' + c.cn.yColumn)\n        .data(function(vm) {return vm.columns;}, gup.keyFun);\n\n    yColumn.enter()\n        .append('g')\n        .classed(c.cn.yColumn, true);\n\n    yColumn.exit().remove();\n\n    yColumn.attr('transform', function(d) {return 'translate(' + d.x + ' 0)';});\n\n    if(dynamic) {\n        yColumn.call(d3.behavior.drag()\n            .origin(function(d) {\n                var movedColumn = d3.select(this);\n                easeColumn(movedColumn, d, -c.uplift);\n                raiseToTop(this);\n                d.calcdata.columnDragInProgress = true;\n                renderScrollbarKit(tableControlView.filter(function(dd) {return d.calcdata.key === dd.key;}), gd);\n                return d;\n            })\n            .on('drag', function(d) {\n                var movedColumn = d3.select(this);\n                var getter = function(dd) {return (d === dd ? d3.event.x : dd.x) + dd.columnWidth / 2;};\n                d.x = Math.max(-c.overdrag, Math.min(d.calcdata.width + c.overdrag - d.columnWidth, d3.event.x));\n\n                var sortableColumns = flatData(yColumn).filter(function(dd) {return dd.calcdata.key === d.calcdata.key;});\n                var newOrder = sortableColumns.sort(function(a, b) {return getter(a) - getter(b);});\n                newOrder.forEach(function(dd, i) {\n                    dd.xIndex = i;\n                    dd.x = d === dd ? dd.x : dd.xScale(dd);\n                });\n\n                yColumn.filter(function(dd) {return d !== dd;})\n                    .transition()\n                    .ease(c.transitionEase)\n                    .duration(c.transitionDuration)\n                    .attr('transform', function(d) {return 'translate(' + d.x + ' 0)';});\n                movedColumn\n                    .call(cancelEeaseColumn)\n                    .attr('transform', 'translate(' + d.x + ' -' + c.uplift + ' )');\n            })\n            .on('dragend', function(d) {\n                var movedColumn = d3.select(this);\n                var p = d.calcdata;\n                d.x = d.xScale(d);\n                d.calcdata.columnDragInProgress = false;\n                easeColumn(movedColumn, d, 0);\n                columnMoved(gd, p, p.columns.map(function(dd) {return dd.xIndex;}));\n            })\n        );\n    }\n\n    yColumn.each(function(d) {\n        Drawing.setClipUrl(d3.select(this), columnBoundaryClipKey(gd, d), gd);\n    });\n\n    var columnBlock = yColumn.selectAll('.' + c.cn.columnBlock)\n        .data(splitData.splitToPanels, gup.keyFun);\n\n    columnBlock.enter()\n        .append('g')\n        .classed(c.cn.columnBlock, true)\n        .attr('id', function(d) {return d.key;});\n\n    columnBlock\n        .style('cursor', function(d) {\n            return d.dragHandle ? 'ew-resize' : d.calcdata.scrollbarState.barWiggleRoom ? 'ns-resize' : 'default';\n        });\n\n    var headerColumnBlock = columnBlock.filter(headerBlock);\n    var cellsColumnBlock = columnBlock.filter(cellsBlock);\n\n    if(dynamic) {\n        cellsColumnBlock.call(d3.behavior.drag()\n            .origin(function(d) {\n                d3.event.stopPropagation();\n                return d;\n            })\n            .on('drag', makeDragRow(gd, tableControlView, -1))\n            .on('dragend', function() {\n                // fixme emit plotly notification\n            })\n        );\n    }\n\n    // initial rendering: header is rendered first, as it may may have async LaTeX (show header first)\n    // but blocks are _entered_ the way they are due to painter's algo (header on top)\n    renderColumnCellTree(gd, tableControlView, headerColumnBlock, columnBlock);\n    renderColumnCellTree(gd, tableControlView, cellsColumnBlock, columnBlock);\n\n    var scrollAreaClip = tableControlView.selectAll('.' + c.cn.scrollAreaClip)\n        .data(gup.repeat, gup.keyFun);\n\n    scrollAreaClip.enter()\n        .append('clipPath')\n        .classed(c.cn.scrollAreaClip, true)\n        .attr('id', function(d) {return scrollAreaBottomClipKey(gd, d);});\n\n    var scrollAreaClipRect = scrollAreaClip.selectAll('.' + c.cn.scrollAreaClipRect)\n        .data(gup.repeat, gup.keyFun);\n\n    scrollAreaClipRect.enter()\n        .append('rect')\n        .classed(c.cn.scrollAreaClipRect, true)\n        .attr('x', -c.overdrag)\n        .attr('y', -c.uplift)\n        .attr('fill', 'none');\n\n    scrollAreaClipRect\n        .attr('width', function(d) {return d.width + 2 * c.overdrag;})\n        .attr('height', function(d) {return d.height + c.uplift;});\n\n    var columnBoundary = yColumn.selectAll('.' + c.cn.columnBoundary)\n        .data(gup.repeat, gup.keyFun);\n\n    columnBoundary.enter()\n        .append('g')\n        .classed(c.cn.columnBoundary, true);\n\n    var columnBoundaryClippath = yColumn.selectAll('.' + c.cn.columnBoundaryClippath)\n        .data(gup.repeat, gup.keyFun);\n\n    // SVG spec doesn't mandate wrapping into a <defs> and doesn't seem to cause a speed difference\n    columnBoundaryClippath.enter()\n        .append('clipPath')\n        .classed(c.cn.columnBoundaryClippath, true);\n\n    columnBoundaryClippath\n        .attr('id', function(d) {return columnBoundaryClipKey(gd, d);});\n\n    var columnBoundaryRect = columnBoundaryClippath.selectAll('.' + c.cn.columnBoundaryRect)\n        .data(gup.repeat, gup.keyFun);\n\n    columnBoundaryRect.enter()\n        .append('rect')\n        .classed(c.cn.columnBoundaryRect, true)\n        .attr('fill', 'none');\n\n    columnBoundaryRect\n        .attr('width', function(d) { return d.columnWidth + 2 * roundHalfWidth(d); })\n        .attr('height', function(d) {return d.calcdata.height + 2 * roundHalfWidth(d) + c.uplift;})\n        .attr('x', function(d) { return -roundHalfWidth(d); })\n        .attr('y', function(d) { return -roundHalfWidth(d); });\n\n    updateBlockYPosition(null, cellsColumnBlock, tableControlView);\n};\n\nfunction roundHalfWidth(d) {\n    return Math.ceil(d.calcdata.maxLineWidth / 2);\n}\n\nfunction scrollAreaBottomClipKey(gd, d) {\n    return 'clip' + gd._fullLayout._uid + '_scrollAreaBottomClip_' + d.key;\n}\n\nfunction columnBoundaryClipKey(gd, d) {\n    return 'clip' + gd._fullLayout._uid + '_columnBoundaryClippath_' + d.calcdata.key + '_' + d.specIndex;\n}\n\nfunction flatData(selection) {\n    return [].concat.apply([], selection.map(function(g) {return g;}))\n        .map(function(g) {return g.__data__;});\n}\n\nfunction renderScrollbarKit(tableControlView, gd, bypassVisibleBar) {\n    function calcTotalHeight(d) {\n        var blocks = d.rowBlocks;\n        return firstRowAnchor(blocks, blocks.length - 1) + (blocks.length ? rowsHeight(blocks[blocks.length - 1], Infinity) : 1);\n    }\n\n    var scrollbarKit = tableControlView.selectAll('.' + c.cn.scrollbarKit)\n        .data(gup.repeat, gup.keyFun);\n\n    scrollbarKit.enter()\n        .append('g')\n        .classed(c.cn.scrollbarKit, true)\n        .style('shape-rendering', 'geometricPrecision');\n\n    scrollbarKit\n        .each(function(d) {\n            var s = d.scrollbarState;\n            s.totalHeight = calcTotalHeight(d);\n            s.scrollableAreaHeight = d.groupHeight - headerHeight(d);\n            s.currentlyVisibleHeight = Math.min(s.totalHeight, s.scrollableAreaHeight);\n            s.ratio = s.currentlyVisibleHeight / s.totalHeight;\n            s.barLength = Math.max(s.ratio * s.currentlyVisibleHeight, c.goldenRatio * c.scrollbarWidth);\n            s.barWiggleRoom = s.currentlyVisibleHeight - s.barLength;\n            s.wiggleRoom = Math.max(0, s.totalHeight - s.scrollableAreaHeight);\n            s.topY = s.barWiggleRoom === 0 ? 0 : (d.scrollY / s.wiggleRoom) * s.barWiggleRoom;\n            s.bottomY = s.topY + s.barLength;\n            s.dragMultiplier = s.wiggleRoom / s.barWiggleRoom;\n        })\n        .attr('transform', function(d) {\n            var xPosition = d.width + c.scrollbarWidth / 2 + c.scrollbarOffset;\n            return 'translate(' + xPosition + ' ' + headerHeight(d) + ')';\n        });\n\n    var scrollbar = scrollbarKit.selectAll('.' + c.cn.scrollbar)\n        .data(gup.repeat, gup.keyFun);\n\n    scrollbar.enter()\n        .append('g')\n        .classed(c.cn.scrollbar, true);\n\n    var scrollbarSlider = scrollbar.selectAll('.' + c.cn.scrollbarSlider)\n        .data(gup.repeat, gup.keyFun);\n\n    scrollbarSlider.enter()\n        .append('g')\n        .classed(c.cn.scrollbarSlider, true);\n\n    scrollbarSlider\n        .attr('transform', function(d) {\n            return 'translate(0 ' + (d.scrollbarState.topY || 0) + ')';\n        });\n\n    var scrollbarGlyph = scrollbarSlider.selectAll('.' + c.cn.scrollbarGlyph)\n        .data(gup.repeat, gup.keyFun);\n\n    scrollbarGlyph.enter()\n        .append('line')\n        .classed(c.cn.scrollbarGlyph, true)\n        .attr('stroke', 'black')\n        .attr('stroke-width', c.scrollbarWidth)\n        .attr('stroke-linecap', 'round')\n        .attr('y1', c.scrollbarWidth / 2);\n\n    scrollbarGlyph\n        .attr('y2', function(d) {\n            return d.scrollbarState.barLength - c.scrollbarWidth / 2;\n        })\n        .attr('stroke-opacity', function(d) {\n            return d.columnDragInProgress || !d.scrollbarState.barWiggleRoom || bypassVisibleBar ? 0 : 0.4;\n        });\n\n    // cancel transition: possible pending (also, delayed) transition\n    scrollbarGlyph\n        .transition().delay(0).duration(0);\n\n    scrollbarGlyph\n        .transition().delay(c.scrollbarHideDelay).duration(c.scrollbarHideDuration)\n        .attr('stroke-opacity', 0);\n\n    var scrollbarCaptureZone = scrollbar.selectAll('.' + c.cn.scrollbarCaptureZone)\n        .data(gup.repeat, gup.keyFun);\n\n    scrollbarCaptureZone.enter()\n        .append('line')\n        .classed(c.cn.scrollbarCaptureZone, true)\n        .attr('stroke', 'white')\n        .attr('stroke-opacity', 0.01) // some browser might get rid of a 0 opacity element\n        .attr('stroke-width', c.scrollbarCaptureWidth)\n        .attr('stroke-linecap', 'butt')\n        .attr('y1', 0)\n        .on('mousedown', function(d) {\n            var y = d3.event.y;\n            var bbox = this.getBoundingClientRect();\n            var s = d.scrollbarState;\n            var pixelVal = y - bbox.top;\n            var inverseScale = d3.scale.linear().domain([0, s.scrollableAreaHeight]).range([0, s.totalHeight]).clamp(true);\n            if(!(s.topY <= pixelVal && pixelVal <= s.bottomY)) {\n                makeDragRow(gd, tableControlView, null, inverseScale(pixelVal - s.barLength / 2))(d);\n            }\n        })\n        .call(d3.behavior.drag()\n            .origin(function(d) {\n                d3.event.stopPropagation();\n                d.scrollbarState.scrollbarScrollInProgress = true;\n                return d;\n            })\n            .on('drag', makeDragRow(gd, tableControlView))\n            .on('dragend', function() {\n                // fixme emit Plotly event\n            })\n        );\n\n    scrollbarCaptureZone\n        .attr('y2', function(d) {\n            return d.scrollbarState.scrollableAreaHeight;\n        });\n\n    // Remove scroll glyph and capture zone on static plots\n    // as they don't render properly when converted to PDF\n    // in the Chrome PDF viewer\n    // https://github.com/plotly/streambed/issues/11618\n    if(gd._context.staticPlot) {\n        scrollbarGlyph.remove();\n        scrollbarCaptureZone.remove();\n    }\n}\n\nfunction renderColumnCellTree(gd, tableControlView, columnBlock, allColumnBlock) {\n    // fixme this perf hotspot\n    // this is performance critical code as scrolling calls it on every revolver switch\n    // it appears sufficiently fast but there are plenty of low-hanging fruits for performance optimization\n\n    var columnCells = renderColumnCells(columnBlock);\n\n    var columnCell = renderColumnCell(columnCells);\n\n    supplyStylingValues(columnCell);\n\n    var cellRect = renderCellRect(columnCell);\n\n    sizeAndStyleRect(cellRect);\n\n    var cellTextHolder = renderCellTextHolder(columnCell);\n\n    var cellText = renderCellText(cellTextHolder);\n\n    setFont(cellText);\n    populateCellText(cellText, tableControlView, allColumnBlock, gd);\n\n    // doing this at the end when text, and text stlying are set\n    setCellHeightAndPositionY(columnCell);\n}\n\nfunction renderColumnCells(columnBlock) {\n    var columnCells = columnBlock.selectAll('.' + c.cn.columnCells)\n        .data(gup.repeat, gup.keyFun);\n\n    columnCells.enter()\n        .append('g')\n        .classed(c.cn.columnCells, true);\n\n    columnCells.exit()\n        .remove();\n\n    return columnCells;\n}\n\nfunction renderColumnCell(columnCells) {\n    var columnCell = columnCells.selectAll('.' + c.cn.columnCell)\n        .data(splitData.splitToCells, function(d) {return d.keyWithinBlock;});\n\n    columnCell.enter()\n        .append('g')\n        .classed(c.cn.columnCell, true);\n\n    columnCell.exit()\n        .remove();\n\n    return columnCell;\n}\n\nfunction renderCellRect(columnCell) {\n    var cellRect = columnCell.selectAll('.' + c.cn.cellRect)\n        .data(gup.repeat, function(d) {return d.keyWithinBlock;});\n\n    cellRect.enter()\n        .append('rect')\n        .classed(c.cn.cellRect, true);\n\n    return cellRect;\n}\n\nfunction renderCellText(cellTextHolder) {\n    var cellText = cellTextHolder.selectAll('.' + c.cn.cellText)\n        .data(gup.repeat, function(d) {return d.keyWithinBlock;});\n\n    cellText.enter()\n        .append('text')\n        .classed(c.cn.cellText, true)\n        .style('cursor', function() {return 'auto';})\n        .on('mousedown', function() {d3.event.stopPropagation();});\n\n    return cellText;\n}\n\nfunction renderCellTextHolder(columnCell) {\n    var cellTextHolder = columnCell.selectAll('.' + c.cn.cellTextHolder)\n        .data(gup.repeat, function(d) {return d.keyWithinBlock;});\n\n    cellTextHolder.enter()\n        .append('g')\n        .classed(c.cn.cellTextHolder, true)\n        .style('shape-rendering', 'geometricPrecision');\n\n    return cellTextHolder;\n}\n\nfunction supplyStylingValues(columnCell) {\n    columnCell\n        .each(function(d, i) {\n            var spec = d.calcdata.cells.font;\n            var col = d.column.specIndex;\n            var font = {\n                size: gridPick(spec.size, col, i),\n                color: gridPick(spec.color, col, i),\n                family: gridPick(spec.family, col, i)\n            };\n            d.rowNumber = d.key;\n            d.align = gridPick(d.calcdata.cells.align, col, i);\n            d.cellBorderWidth = gridPick(d.calcdata.cells.line.width, col, i);\n            d.font = font;\n        });\n}\n\nfunction setFont(cellText) {\n    cellText\n        .each(function(d) {\n            Drawing.font(d3.select(this), d.font);\n        });\n}\n\nfunction sizeAndStyleRect(cellRect) {\n    cellRect\n        .attr('width', function(d) {return d.column.columnWidth;})\n        .attr('stroke-width', function(d) {return d.cellBorderWidth;})\n        .each(function(d) {\n            var atomicSelection = d3.select(this);\n            Color.stroke(atomicSelection, gridPick(d.calcdata.cells.line.color, d.column.specIndex, d.rowNumber));\n            Color.fill(atomicSelection, gridPick(d.calcdata.cells.fill.color, d.column.specIndex, d.rowNumber));\n        });\n}\n\nfunction populateCellText(cellText, tableControlView, allColumnBlock, gd) {\n    cellText\n        .text(function(d) {\n            var col = d.column.specIndex;\n            var row = d.rowNumber;\n\n            var userSuppliedContent = d.value;\n            var stringSupplied = (typeof userSuppliedContent === 'string');\n            var hasBreaks = stringSupplied && userSuppliedContent.match(/<br>/i);\n            var userBrokenText = !stringSupplied || hasBreaks;\n            d.mayHaveMarkup = stringSupplied && userSuppliedContent.match(/[<&>]/);\n\n            var latex = isLatex(userSuppliedContent);\n            d.latex = latex;\n\n            var prefix = latex ? '' : gridPick(d.calcdata.cells.prefix, col, row) || '';\n            var suffix = latex ? '' : gridPick(d.calcdata.cells.suffix, col, row) || '';\n            var format = latex ? null : gridPick(d.calcdata.cells.format, col, row) || null;\n\n            var prefixSuffixedText = prefix + (format ? d3.format(format)(d.value) : d.value) + suffix;\n\n            var hasWrapSplitCharacter;\n            d.wrappingNeeded = !d.wrapped && !userBrokenText && !latex && (hasWrapSplitCharacter = hasWrapCharacter(prefixSuffixedText));\n            d.cellHeightMayIncrease = hasBreaks || latex || d.mayHaveMarkup || (hasWrapSplitCharacter === void(0) ? hasWrapCharacter(prefixSuffixedText) : hasWrapSplitCharacter);\n            d.needsConvertToTspans = d.mayHaveMarkup || d.wrappingNeeded || d.latex;\n\n            var textToRender;\n            if(d.wrappingNeeded) {\n                var hrefPreservedText = c.wrapSplitCharacter === ' ' ? prefixSuffixedText.replace(/<a href=/ig, '<a_href=') : prefixSuffixedText;\n                var fragments = hrefPreservedText.split(c.wrapSplitCharacter);\n                var hrefRestoredFragments = c.wrapSplitCharacter === ' ' ? fragments.map(function(frag) {return frag.replace(/<a_href=/ig, '<a href=');}) : fragments;\n                d.fragments = hrefRestoredFragments.map(function(f) {return {text: f, width: null};});\n                d.fragments.push({fragment: c.wrapSpacer, width: null});\n                textToRender = hrefRestoredFragments.join(c.lineBreaker) + c.lineBreaker + c.wrapSpacer;\n            } else {\n                delete d.fragments;\n                textToRender = prefixSuffixedText;\n            }\n\n            return textToRender;\n        })\n        .attr('dy', function(d) {\n            return d.needsConvertToTspans ? 0 : '0.75em';\n        })\n        .each(function(d) {\n            var element = this;\n            var selection = d3.select(element);\n\n            // finalize what's in the DOM\n\n            var renderCallback = d.wrappingNeeded ? wrapTextMaker : updateYPositionMaker;\n            if(d.needsConvertToTspans) {\n                svgUtil.convertToTspans(selection, gd, renderCallback(allColumnBlock, element, tableControlView, gd, d));\n            } else {\n                d3.select(element.parentNode)\n                    // basic cell adjustment - compliance with `cellPad`\n                    .attr('transform', function(d) {return 'translate(' + xPosition(d) + ' ' + c.cellPad + ')';})\n                    .attr('text-anchor', function(d) {\n                        return ({\n                            left: 'start',\n                            center: 'middle',\n                            right: 'end'\n                        })[d.align];\n                    });\n            }\n        });\n}\n\nfunction isLatex(content) {\n    return typeof content === 'string' && content.match(c.latexCheck);\n}\n\nfunction hasWrapCharacter(text) {return text.indexOf(c.wrapSplitCharacter) !== -1;}\n\nfunction columnMoved(gd, calcdata, indices) {\n    var o = calcdata.gdColumnsOriginalOrder;\n    calcdata.gdColumns.sort(function(a, b) {\n        return indices[o.indexOf(a)] - indices[o.indexOf(b)];\n    });\n\n    calcdata.columnorder = indices;\n\n    // TODO: there's no data here, but also this reordering is not reflected\n    // in gd.data or even gd._fullData.\n    // For now I will not attempt to persist this in _preGUI\n    gd.emit('plotly_restyle');\n}\n\nfunction gridPick(spec, col, row) {\n    if(Array.isArray(spec)) {\n        var column = spec[Math.min(col, spec.length - 1)];\n        if(Array.isArray(column)) {\n            return column[Math.min(row, column.length - 1)];\n        } else {\n            return column;\n        }\n    } else {\n        return spec;\n    }\n}\n\nfunction easeColumn(selection, d, y) {\n    selection\n        .transition()\n        .ease(c.releaseTransitionEase)\n        .duration(c.releaseTransitionDuration)\n        .attr('transform', 'translate(' + d.x + ' ' + y + ')');\n}\n\nfunction cellsBlock(d) {return d.type === 'cells';}\nfunction headerBlock(d) {return d.type === 'header';}\n\n/**\n * Revolver panel and cell contents layouting\n */\n\nfunction headerHeight(d) {\n    var headerBlocks = d.rowBlocks.length ? d.rowBlocks[0].auxiliaryBlocks : [];\n    return headerBlocks.reduce(function(p, n) {return p + rowsHeight(n, Infinity);}, 0);\n}\n\nfunction findPagesAndCacheHeights(blocks, scrollY, scrollHeight) {\n    var pages = [];\n    var pTop = 0;\n\n    for(var blockIndex = 0; blockIndex < blocks.length; blockIndex++) {\n        var block = blocks[blockIndex];\n        var blockRows = block.rows;\n        var rowsHeight = 0;\n        for(var i = 0; i < blockRows.length; i++) {\n            rowsHeight += blockRows[i].rowHeight;\n        }\n\n        // caching allRowsHeight on the block - it's safe as this function is always called from within the code part\n        // that handles increases to row heights\n        block.allRowsHeight = rowsHeight;\n\n        var pBottom = pTop + rowsHeight;\n        var windowTop = scrollY;\n        var windowBottom = windowTop + scrollHeight;\n        if(windowTop < pBottom && windowBottom > pTop) {\n            pages.push(blockIndex);\n        }\n        pTop += rowsHeight;\n\n        // consider this nice final optimization; put it in `for` condition - caveat, currently the\n        // block.allRowsHeight relies on being invalidated, so enabling this opt may not be safe\n        // if(pages.length > 1) break;\n    }\n\n    return pages;\n}\n\nfunction updateBlockYPosition(gd, cellsColumnBlock, tableControlView) {\n    var d = flatData(cellsColumnBlock)[0];\n    if(d === undefined) return;\n    var blocks = d.rowBlocks;\n    var calcdata = d.calcdata;\n\n    var bottom = firstRowAnchor(blocks, blocks.length);\n    var scrollHeight = d.calcdata.groupHeight - headerHeight(d);\n    var scrollY = calcdata.scrollY = Math.max(0, Math.min(bottom - scrollHeight, calcdata.scrollY));\n\n    var pages = findPagesAndCacheHeights(blocks, scrollY, scrollHeight);\n    if(pages.length === 1) {\n        if(pages[0] === blocks.length - 1) {\n            pages.unshift(pages[0] - 1);\n        } else {\n            pages.push(pages[0] + 1);\n        }\n    }\n\n    // make phased out page jump by 2 while leaving stationary page intact\n    if(pages[0] % 2) {\n        pages.reverse();\n    }\n\n    cellsColumnBlock\n        .each(function(d, i) {\n            // these values will also be needed when a block is translated again due to growing cell height\n            d.page = pages[i];\n            d.scrollY = scrollY;\n        });\n\n    cellsColumnBlock\n        .attr('transform', function(d) {\n            var yTranslate = firstRowAnchor(d.rowBlocks, d.page) - d.scrollY;\n            return 'translate(0 ' + yTranslate + ')';\n        });\n\n    // conditionally rerendering panel 0 and 1\n    if(gd) {\n        conditionalPanelRerender(gd, tableControlView, cellsColumnBlock, pages, d.prevPages, d, 0);\n        conditionalPanelRerender(gd, tableControlView, cellsColumnBlock, pages, d.prevPages, d, 1);\n        renderScrollbarKit(tableControlView, gd);\n    }\n}\n\nfunction makeDragRow(gd, allTableControlView, optionalMultiplier, optionalPosition) {\n    return function dragRow(eventD) {\n        // may come from whichever DOM event target: drag, wheel, bar... eventD corresponds to event target\n        var d = eventD.calcdata ? eventD.calcdata : eventD;\n        var tableControlView = allTableControlView.filter(function(dd) {return d.key === dd.key;});\n        var multiplier = optionalMultiplier || d.scrollbarState.dragMultiplier;\n\n        var initialScrollY = d.scrollY;\n\n        d.scrollY = optionalPosition === void(0) ? d.scrollY + multiplier * d3.event.dy : optionalPosition;\n        var cellsColumnBlock = tableControlView.selectAll('.' + c.cn.yColumn).selectAll('.' + c.cn.columnBlock).filter(cellsBlock);\n        updateBlockYPosition(gd, cellsColumnBlock, tableControlView);\n\n        // return false if we've \"used\" the scroll, ie it did something,\n        // so the event shouldn't bubble (if appropriate)\n        return d.scrollY === initialScrollY;\n    };\n}\n\nfunction conditionalPanelRerender(gd, tableControlView, cellsColumnBlock, pages, prevPages, d, revolverIndex) {\n    var shouldComponentUpdate = pages[revolverIndex] !== prevPages[revolverIndex];\n    if(shouldComponentUpdate) {\n        clearTimeout(d.currentRepaint[revolverIndex]);\n        d.currentRepaint[revolverIndex] = setTimeout(function() {\n            // setTimeout might lag rendering but yields a smoother scroll, because fast scrolling makes\n            // some repaints invisible ie. wasteful (DOM work blocks the main thread)\n            var toRerender = cellsColumnBlock.filter(function(d, i) {return i === revolverIndex && pages[i] !== prevPages[i];});\n            renderColumnCellTree(gd, tableControlView, toRerender, cellsColumnBlock);\n            prevPages[revolverIndex] = pages[revolverIndex];\n        });\n    }\n}\n\nfunction wrapTextMaker(columnBlock, element, tableControlView, gd) {\n    return function wrapText() {\n        var cellTextHolder = d3.select(element.parentNode);\n        cellTextHolder\n            .each(function(d) {\n                var fragments = d.fragments;\n                cellTextHolder.selectAll('tspan.line').each(function(dd, i) {\n                    fragments[i].width = this.getComputedTextLength();\n                });\n                // last element is only for measuring the separator character, so it's ignored:\n                var separatorLength = fragments[fragments.length - 1].width;\n                var rest = fragments.slice(0, -1);\n                var currentRow = [];\n                var currentAddition, currentAdditionLength;\n                var currentRowLength = 0;\n                var rowLengthLimit = d.column.columnWidth - 2 * c.cellPad;\n                d.value = '';\n                while(rest.length) {\n                    currentAddition = rest.shift();\n                    currentAdditionLength = currentAddition.width + separatorLength;\n                    if(currentRowLength + currentAdditionLength > rowLengthLimit) {\n                        d.value += currentRow.join(c.wrapSpacer) + c.lineBreaker;\n                        currentRow = [];\n                        currentRowLength = 0;\n                    }\n                    currentRow.push(currentAddition.text);\n                    currentRowLength += currentAdditionLength;\n                }\n                if(currentRowLength) {\n                    d.value += currentRow.join(c.wrapSpacer);\n                }\n                d.wrapped = true;\n            });\n\n        // the pre-wrapped text was rendered only for the text measurements\n        cellTextHolder.selectAll('tspan.line').remove();\n\n        // resupply text, now wrapped\n        populateCellText(cellTextHolder.select('.' + c.cn.cellText), tableControlView, columnBlock, gd);\n        d3.select(element.parentNode.parentNode).call(setCellHeightAndPositionY);\n    };\n}\n\nfunction updateYPositionMaker(columnBlock, element, tableControlView, gd, d) {\n    return function updateYPosition() {\n        if(d.settledY) return;\n        var cellTextHolder = d3.select(element.parentNode);\n        var l = getBlock(d);\n        var rowIndex = d.key - l.firstRowIndex;\n\n        var declaredRowHeight = l.rows[rowIndex].rowHeight;\n\n        var requiredHeight = d.cellHeightMayIncrease ? element.parentNode.getBoundingClientRect().height + 2 * c.cellPad : declaredRowHeight;\n\n        var finalHeight = Math.max(requiredHeight, declaredRowHeight);\n        var increase = finalHeight - l.rows[rowIndex].rowHeight;\n\n        if(increase) {\n            // current row height increased\n            l.rows[rowIndex].rowHeight = finalHeight;\n\n            columnBlock\n                .selectAll('.' + c.cn.columnCell)\n                .call(setCellHeightAndPositionY);\n\n            updateBlockYPosition(null, columnBlock.filter(cellsBlock), 0);\n\n            // if d.column.type === 'header', then the scrollbar has to be pushed downward to the scrollable area\n            // if d.column.type === 'cells', it can still be relevant if total scrolling content height is less than the\n            //                               scrollable window, as increases to row heights may need scrollbar updates\n            renderScrollbarKit(tableControlView, gd, true);\n        }\n\n        cellTextHolder\n            .attr('transform', function() {\n                // this code block is only invoked for items where d.cellHeightMayIncrease is truthy\n                var element = this;\n                var columnCellElement = element.parentNode;\n                var box = columnCellElement.getBoundingClientRect();\n                var rectBox = d3.select(element.parentNode).select('.' + c.cn.cellRect).node().getBoundingClientRect();\n                var currentTransform = element.transform.baseVal.consolidate();\n                var yPosition = rectBox.top - box.top + (currentTransform ? currentTransform.matrix.f : c.cellPad);\n                return 'translate(' + xPosition(d, d3.select(element.parentNode).select('.' + c.cn.cellTextHolder).node().getBoundingClientRect().width) + ' ' + yPosition + ')';\n            });\n\n        d.settledY = true;\n    };\n}\n\nfunction xPosition(d, optionalWidth) {\n    switch(d.align) {\n        case 'left': return c.cellPad;\n        case 'right': return d.column.columnWidth - (optionalWidth || 0) - c.cellPad;\n        case 'center': return (d.column.columnWidth - (optionalWidth || 0)) / 2;\n        default: return c.cellPad;\n    }\n}\n\nfunction setCellHeightAndPositionY(columnCell) {\n    columnCell\n        .attr('transform', function(d) {\n            var headerHeight = d.rowBlocks[0].auxiliaryBlocks.reduce(function(p, n) {return p + rowsHeight(n, Infinity);}, 0);\n            var l = getBlock(d);\n            var rowAnchor = rowsHeight(l, d.key);\n            var yOffset = rowAnchor + headerHeight;\n            return 'translate(0 ' + yOffset + ')';\n        })\n        .selectAll('.' + c.cn.cellRect)\n        .attr('height', function(d) {return getRow(getBlock(d), d.key).rowHeight;});\n}\n\nfunction firstRowAnchor(blocks, page) {\n    var total = 0;\n    for(var i = page - 1; i >= 0; i--) {\n        total += allRowsHeight(blocks[i]);\n    }\n    return total;\n}\n\nfunction rowsHeight(rowBlock, key) {\n    var total = 0;\n    for(var i = 0; i < rowBlock.rows.length && rowBlock.rows[i].rowIndex < key; i++) {\n        total += rowBlock.rows[i].rowHeight;\n    }\n    return total;\n}\n\nfunction allRowsHeight(rowBlock) {\n    var cached = rowBlock.allRowsHeight;\n\n    if(cached !== void(0)) {\n        return cached;\n    }\n\n    var total = 0;\n    for(var i = 0; i < rowBlock.rows.length; i++) {\n        total += rowBlock.rows[i].rowHeight;\n    }\n    rowBlock.allRowsHeight = total;\n\n    return total;\n}\n\nfunction getBlock(d) {return d.rowBlocks[d.page];}\nfunction getRow(l, i) {return l.rows[i - l.firstRowIndex];}\n"]},"metadata":{},"sourceType":"script"}